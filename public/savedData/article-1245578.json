{"type_of":"article","id":1245578,"title":"Creating a Multi-Account CI/CD Pipeline with AWS CodePipeline","description":"Whenever I've tried to learn a particular service or functionality within AWS, I find the best way is...","readable_publish_date":"Nov 6","slug":"creating-a-multi-account-cicd-pipeline-with-aws-codepipeline-198h","path":"/adamdivall/creating-a-multi-account-cicd-pipeline-with-aws-codepipeline-198h","url":"https://dev.to/adamdivall/creating-a-multi-account-cicd-pipeline-with-aws-codepipeline-198h","comments_count":0,"public_reactions_count":2,"collection_id":null,"published_timestamp":"2022-11-06T14:55:29Z","positive_reactions_count":2,"cover_image":null,"social_image":"https://dev.to/social_previews/article/1245578.png","canonical_url":"https://www.adamdivall.co.uk/article/creating-a-multi-account-pipeline-with-codepipeline/","created_at":"2022-11-06T14:55:30Z","edited_at":null,"crossposted_at":null,"published_at":"2022-11-06T14:55:29Z","last_comment_at":"2022-11-06T14:55:29Z","reading_time_minutes":16,"tag_list":"cloud, devops, aws","tags":["cloud","devops","aws"],"body_html":"<p>Whenever I've tried to learn a particular service or functionality within AWS, I find the best way is to do the ClickOps approach (i.e. Good Old Point and Click in the Console).  Once I've figured out how to get it working via that method, I then go through the process of trying to automate it through Infrastructure as Code and in my case thats using AWS CloudFormation.  </p>\n\n<p>One particular example of this was getting a bit more familiar with AWS CodePipeline so that I could try to automate the delivery of CloudFormation Templates across multiple AWS Accounts in a similar manner as to how you would deploy solutions in a Software Delivery Lifecycle (SDLC).  When I was learning how to do this through the management console, I found out that its not possible to do it all within the console and therefore you have to also leverage the AWS CLI for specific parts.</p>\n\n<p>This blog post aims to walkthrough the steps that you'd need to take to create a relatively simple CI/CD pipeline using the AWS CodeCommit, AWS CodeBuild and AWS CodePipeline so that we can deploy a simple CloudFormation template into multiple AWS Accounts via an automated manner.</p>\n\n<p>The flow of the CI/CD pipeline will be as follows:</p>\n\n<ul>\n<li>  A CloudFormation template gets committed to a CodeCommit repository.</li>\n<li>  Upon the detection of changes in that repository the CodePipeline will trigger a deployment run.</li>\n<li>  CodeBuild will run a linting check against the CloudFormation Template using <a href=\"https://github.com/aws-cloudformation/cfn-lint\">cfn-lint</a> and will then run <a href=\"https://github.com/stelligent/cfn_nag\">cfn-nag</a> to check for patterns that indicate insecure resources within the CloudFormation template.</li>\n<li>  The CloudFormation template will then be deployed into the same AWS Account as where the CI/CD pipeline is.</li>\n<li>  Finally the CloudFormation template will then be deployed into a different AWS Account.</li>\n</ul>\n\n<p>For the purpose of this blog post I'm going to use 3 AWS Accounts - Tooling, Development &amp; Production.  I'll be configuring the pipeline within the Tooling Account that will then deploy the CloudFormation Template into Development and then once an approval has been granted will then deploy to Production.</p>\n\n<h3>\n  <a name=\"create-the-codecommit-repository\" href=\"#create-the-codecommit-repository\">\n  </a>\n  Create the CodeCommit Repository\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodeCommit Service.</li>\n<li>  Click <strong>Create repository</strong>. </li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--n8jSeUOR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goh1tc1p1gat8c5yupub.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--n8jSeUOR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goh1tc1p1gat8c5yupub.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Create repository page, Enter a <strong>CloudFormation-Repository</strong> and Click <strong>Create</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--4t54Q73B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/l4z1lxyvaub4tyf7nxqb.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--4t54Q73B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/l4z1lxyvaub4tyf7nxqb.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<h3>\n  <a name=\"configure-an-aws-cli-profile-to-the-tooling-account\" href=\"#configure-an-aws-cli-profile-to-the-tooling-account\">\n  </a>\n  Configure an AWS CLI Profile to the Tooling Account\n</h3>\n\n<ul>\n<li>  Establish an AWS CLI Profile to the Management Account with administrative credentials via the AWS CLI using either a Command Prompt or from Powershell:\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>aws configure sso\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<ul>\n<li>  In the SSO start URL, type the <strong>URL of the SSO Login page</strong>. For example., <a href=\"https://d-1234567890.awsapps.com/start\">https://d-1234567890.awsapps.com/start</a>  This can be found by logging into the IAM Identity Center Console and looking for the AWS access portal URL in the Settings.</li>\n<li>  In the SSO Region, type the <strong>AWS Region</strong> that was used for the Home Region when deploying Control Tower. For example., eu-west-2</li>\n</ul>\n\n<p>A Web Browser will then Open prompting for Login Credentials if you're not already logged in.  </p>\n\n<ul>\n<li>  Login with your Username and Password.</li>\n<li>  Click <strong>Allow</strong>.</li>\n<li>  Select the <strong>Tooling Account</strong> using the cursor keys.</li>\n<li>  Press <strong>Return</strong> for the default client Region and the default output format.</li>\n<li>  For the Profile name use something memorable as this can be anything. For example., tooling</li>\n</ul>\n\n<h3>\n  <a name=\"clone-the-codecommit-repository\" href=\"#clone-the-codecommit-repository\">\n  </a>\n  Clone the CodeCommit Repository\n</h3>\n\n<ul>\n<li>  Install the git-remote-codecommit module via either a Command Prompt or Powershell.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight python\"><code><span class=\"n\">pip</span> <span class=\"n\">install</span> <span class=\"n\">git</span><span class=\"o\">-</span><span class=\"n\">remote</span><span class=\"o\">-</span><span class=\"n\">codecommit</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<ul>\n<li>  Clone the CodeCommit repository via either a Command Prompt or Powershell.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>git clone codecommit://tooling@CloudFormation-Repository CloudFormation-Repository\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> You'll need to ensure that you use the name of you AWS CLI profile prior to the <code>@</code> as shown in the example above.</p>\n\n<h3>\n  <a name=\"create-the-cloudformation-template-and-push-to-codecommit\" href=\"#create-the-cloudformation-template-and-push-to-codecommit\">\n  </a>\n  Create the CloudFormation Template and Push to CodeCommit\n</h3>\n\n<ul>\n<li>  Create a file named <strong>cloudformation.yaml</strong>  with the below content in CloudFormation-Repository folder, where you cloned the repository to.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">AWSTemplateFormatVersion</span><span class=\"pi\">:</span> <span class=\"s\">2010-09-09</span>\n<span class=\"na\">Resources</span><span class=\"pi\">:</span>\n  <span class=\"na\">S3Bucket</span><span class=\"pi\">:</span>\n    <span class=\"na\">Type</span><span class=\"pi\">:</span> <span class=\"s\">AWS::S3::Bucket</span>\n    <span class=\"na\">Properties</span><span class=\"pi\">:</span> \n      <span class=\"na\">BucketName</span><span class=\"pi\">:</span> <span class=\"s\">automated-deployment-${AWS::Region}-${AWS::AccountId}</span>\n      <span class=\"na\">BucketEncryption</span><span class=\"pi\">:</span>\n        <span class=\"na\">ServerSideEncryptionConfiguration</span><span class=\"pi\">:</span>\n          <span class=\"pi\">-</span> <span class=\"na\">ServerSideEncryptionByDefault</span><span class=\"pi\">:</span>\n              <span class=\"na\">SSEAlgorithm</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">AES256'</span>\n      <span class=\"na\">PublicAccessBlockConfiguration</span><span class=\"pi\">:</span>\n          <span class=\"na\">BlockPublicAcls</span><span class=\"pi\">:</span> <span class=\"no\">true</span>\n          <span class=\"na\">BlockPublicPolicy</span><span class=\"pi\">:</span> <span class=\"no\">true</span>\n          <span class=\"na\">IgnorePublicAcls</span><span class=\"pi\">:</span> <span class=\"no\">true</span>\n          <span class=\"na\">RestrictPublicBuckets</span><span class=\"pi\">:</span> <span class=\"no\">true</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<ul>\n<li>  Commit the Code to the CodeCommit Repository via either a Command Prompt or Powershell.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>git add .\ngit commit -m \"Initial Commit\"\ngit push\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h3>\n  <a name=\"create-the-cloudformation-service-role\" href=\"#create-the-cloudformation-service-role\">\n  </a>\n  Create the CloudFormation Service Role\n</h3>\n\n<ul>\n<li>  For both the Development and Production AWS Accounts follow the below steps.</li>\n<li>  Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.</li>\n<li>  Click <strong>Roles</strong>.</li>\n<li>  Click <strong>Create Role</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--crOhXI3d--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fmyzwl2y4iqt91fyjicu.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--crOhXI3d--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fmyzwl2y4iqt91fyjicu.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Select trusted entity page, Ensure that the trusted entity is set to <strong>AWS service</strong> and then under Use cases for other AWS services, Select <strong>CloudFormation</strong> from the dropdown list and then Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SvTgx0po--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lb2ztybhiq2jih4wujah.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--SvTgx0po--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lb2ztybhiq2jih4wujah.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Add permission page, Select the <strong>AdministratorAccess</strong> from the Permissions policies and then Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--y2kko1xr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7kcbd2tnq3cj7y6qiarj.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--y2kko1xr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7kcbd2tnq3cj7y6qiarj.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Name, review and create page, In the Role Name type <strong>CloudFormation-Admin</strong> and then Click <strong>Create role</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Soh5Dw26--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fytfgnsuh3vgvszdj0q2.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Soh5Dw26--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fytfgnsuh3vgvszdj0q2.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<h3>\n  <a name=\"create-the-kms-key-for-pipeline-artifacts\" href=\"#create-the-kms-key-for-pipeline-artifacts\">\n  </a>\n  Create the KMS Key for Pipeline Artifacts\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the KMS Service.</li>\n<li>  Click <strong>Create a key</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--J1MqdmkB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sazcs6xowcach7u7gn13.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--J1MqdmkB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sazcs6xowcach7u7gn13.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Configure key page, Leave the default options and Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--LRV5kIw4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/y9c1m7wejr8i4zs2fiog.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--LRV5kIw4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/y9c1m7wejr8i4zs2fiog.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Alias page, Create an Alias named <strong>Pipeline-Artifacts</strong> and Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--4GTf1qV8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5mabvixdlu32w3xzda71.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--4GTf1qV8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5mabvixdlu32w3xzda71.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Define key administrative permissions page, Select the Role that begins with the prefix of <strong>AWSReservedSSO_AdministratorAccess</strong>.</li>\n<li>  Ensure that the Checkbox for Allow key administrators to delete this key is Selected and Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ES6pPpAo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6zim14hgpkttcltr55tn.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ES6pPpAo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6zim14hgpkttcltr55tn.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Define key usage permissions page, Click <strong>Add another AWS Account</strong>.</li>\n<li>  Enter the 12 Digit Account ID of the Development Account and then Click <strong>Add another AWS Account</strong>.</li>\n<li>  Enter the 12 Digit Account ID of the Production Account and then Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qYyrAHSg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cissyipmcngr7d9kpqst.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--qYyrAHSg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cissyipmcngr7d9kpqst.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Review page, Click <strong>Finish</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--KskN4hfA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lv8fhnv899kbputs1ge9.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--KskN4hfA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lv8fhnv899kbputs1ge9.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<h3>\n  <a name=\"create-the-s3-bucket-for-pipeline-artifacts\" href=\"#create-the-s3-bucket-for-pipeline-artifacts\">\n  </a>\n  Create the S3 Bucket for Pipeline Artifacts\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the S3 Service.</li>\n<li>  Click <strong>Create bucket</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--I7aNn2bE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h8lq77iyyayutwez4pzh.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--I7aNn2bE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h8lq77iyyayutwez4pzh.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Create bucket pagec, Enter a globall unique Bucket name.  In this example, I've suffixed the name pipeline-artifacts with the region and the AWS Account ID.</li>\n<li>  Set the Bucket Versioning to <strong>Enable</strong>.</li>\n<li>  Set the Default encryption to <strong>Enable</strong>, Select <strong>AWS Key Management Service key (SSE-KMS)</strong>, Select <strong>Choose from your AWS KMS keys</strong> and then Choose the KMS Key that we previously created.</li>\n<li>  Click <strong>Create bucket</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Yk10CK6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5p14xsaviy5ui1cpeodj.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Yk10CK6I--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5p14xsaviy5ui1cpeodj.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--bOeK7lAu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z62u99q2ejs5m6bf9gqv.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--bOeK7lAu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z62u99q2ejs5m6bf9gqv.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oGzb8Tfk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/60fl0m307thxq4sj7mbp.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oGzb8Tfk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/60fl0m307thxq4sj7mbp.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  In the S3 Service Console, Click <strong>Buckets</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--69NGEftj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bnokaptbrthxmd6omids.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--69NGEftj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bnokaptbrthxmd6omids.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click the <strong>pipeline-artifacts</strong> Bucket that we previously created.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--GFFbgEsg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mb86kig3khd9pcoho6a8.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--GFFbgEsg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mb86kig3khd9pcoho6a8.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click the <strong>Permissions</strong> Tab.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OhWcWd6v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5k0glriwfplo4sctaruj.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OhWcWd6v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5k0glriwfplo4sctaruj.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Under the Bucket policy section, Click <strong>Edit</strong>. </li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--rdk05O3M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b4ktmyjw8801eut0ql4t.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--rdk05O3M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b4ktmyjw8801eut0ql4t.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Enter the below JSON Policy.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"Version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2012-10-17\"</span><span class=\"p\">,</span><span class=\"w\">\n        </span><span class=\"nl\">\"Statement\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n          </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Deny\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"s3:PutObject\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;/*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Condition\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n              </span><span class=\"nl\">\"StringNotEquals\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"s3:x-amz-server-side-encryption\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"aws:kms\"</span><span class=\"w\">\n              </span><span class=\"p\">}</span><span class=\"w\">\n            </span><span class=\"p\">}</span><span class=\"w\">\n          </span><span class=\"p\">},</span><span class=\"w\">\n          </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"s3:*\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Deny\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;\"</span><span class=\"p\">,</span><span class=\"w\">\n              </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;/*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Condition\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n              </span><span class=\"nl\">\"Bool\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"aws:SecureTransport\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\">\n              </span><span class=\"p\">}</span><span class=\"w\">\n            </span><span class=\"p\">}</span><span class=\"w\">\n          </span><span class=\"p\">},</span><span class=\"w\">\n          </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n              </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:root\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:root\"</span><span class=\"w\">\n              </span><span class=\"p\">],</span><span class=\"w\">\n              </span><span class=\"nl\">\"Service\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"codebuild.amazonaws.com\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"s3:Get*\"</span><span class=\"p\">,</span><span class=\"w\">\n              </span><span class=\"s2\">\"s3:Put*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;/*\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n          </span><span class=\"p\">},</span><span class=\"w\">\n          </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n              </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:root\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:root\"</span><span class=\"w\">\n              </span><span class=\"p\">],</span><span class=\"w\">\n              </span><span class=\"nl\">\"Service\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"codebuild.amazonaws.com\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"s3:ListBucket\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n              </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n          </span><span class=\"p\">}</span><span class=\"w\">\n        </span><span class=\"p\">]</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above IAM Policy, replace <code>&lt;Tooling-Account-ID&gt;</code> with the Account ID of your own Tooling Account, replace <code>&lt;Development-Account-ID&gt;</code> with the Account ID of your own Development Account, and replace <code>&lt;Production-Account-ID&gt;</code> with the Account ID of your own Production Account.</p>\n\n<ul>\n<li>  Click <strong>Save changes</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"create-the-iam-role-for-crossaccount-access\" href=\"#create-the-iam-role-for-crossaccount-access\">\n  </a>\n  Create the IAM Role for Cross-Account Access\n</h3>\n\n<ul>\n<li>  For both the Development and Production AWS Accounts follow the below steps.</li>\n<li>  Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.</li>\n<li>  Click <strong>Roles</strong>.</li>\n<li>  Click <strong>Create Role</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JDhEBkJW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/f04zfo83atlnv54ohj7u.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JDhEBkJW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/f04zfo83atlnv54ohj7u.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Select trusted entity page, Ensure that the trusted entity is set to <strong>AWS account</strong> and then under Another AWS account enter the 12 Digit Account ID for the Tooling Account and then Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--XMgdFsk5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/024zf1ut0otkzby4ielj.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--XMgdFsk5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/024zf1ut0otkzby4ielj.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Add permission page, Click <strong>Create policy</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--mM2UxGku--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/aie4qqx3jmg6em2p8wg8.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--mM2UxGku--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/aie4qqx3jmg6em2p8wg8.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Create policy page, Click the <strong>JSON</strong> Tab.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--au2VpoY5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/egb366pw8ch9sobvdclb.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--au2VpoY5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/egb366pw8ch9sobvdclb.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Replace everything in the existing JSON Policy with the below.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"Version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2012-10-17\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"Statement\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:DescribeKey\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:GenerateDataKey*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Encrypt\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:ReEncrypt*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Decrypt\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:kms:eu-west-2:&lt;Tooling-Account-ID&gt;:key/*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"iam:PassRole\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:Get*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:Put*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:ListBucket\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;/*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above IAM Policy, replace <code>&lt;Tooling-Account-ID&gt;</code> with the Account ID of your own Tooling Account.</p>\n\n<ul>\n<li>  Click <strong>Next: Tags</strong>.</li>\n<li>  Click <strong>Next: Review</strong>.</li>\n<li>  On the Review policy page, In the Policy name type <strong>Pipeline-Cross-Account-Access</strong> and Click <strong>Create policy</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--KJOP0uCp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/34aq7zb588xng1j2e0w8.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--KJOP0uCp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/34aq7zb588xng1j2e0w8.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<p>Return to the Browser Tab for the Creation of the IAM Role and Click the <strong>Refresh</strong> Button.  The button with 2 Arrows on and then the IAM Policy that was just created will be visible.</p>\n\n<ul>\n<li>  Select the <strong>Pipeline-Cross-Account-Access</strong> permissions policies and then Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ouXQtvRT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zzsti2vi27cy2kv6ihwn.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ouXQtvRT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zzsti2vi27cy2kv6ihwn.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Name, review, and create page, In the role name type <strong>Cross-Account-Role</strong> and Click <strong>Create role</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--EpoTsYaF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mlpsxprrwl5ikenut8r0.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--EpoTsYaF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mlpsxprrwl5ikenut8r0.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<h3>\n  <a name=\"create-the-cloudformation-tests-build-project-in-codebuild\" href=\"#create-the-cloudformation-tests-build-project-in-codebuild\">\n  </a>\n  Create the CloudFormation Tests Build Project in CodeBuild\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodeBuild Service.</li>\n<li>  Click <strong>Create build project</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--_Edy6-FQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4dlyo9pt4joegel273qn.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--_Edy6-FQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4dlyo9pt4joegel273qn.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Create build project page under the Project configuration section, In the Project name type <strong>CloudFormation-Tests</strong>.</li>\n<li>  Under the Source section, In the Source provider select <strong>AWS CodeCommit</strong>.</li>\n<li>  In the Repository select <strong>CloudFormation-Repository</strong>.</li>\n<li>  In the Branch select <strong>main</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--3mDFMHeg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sve5rtbxag5oerslppf9.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--3mDFMHeg--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sve5rtbxag5oerslppf9.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Under the Environment section, Select <strong>Managed image</strong>.</li>\n<li>  In the Operating system, Select <strong>Ubuntu</strong>.</li>\n<li>  In the Runtimes, Select <strong>Standard</strong>.</li>\n<li>  In the Image, Select <strong>aws/codebuild/standard:6.0</strong>.</li>\n<li>  In the Image version, Select <strong>Always use the latest image for this runtime version</strong>.</li>\n<li>  In the Environment type, Select <strong>Linux</strong>.</li>\n<li>  In the Service role, Select <strong>New service role</strong>.</li>\n<li>  In the Role name, Type <strong>CodeBuild-CloudFormation-Tests</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--7jqA4yki--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/r3t65g8wor9qfmd3jcq2.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--7jqA4yki--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/r3t65g8wor9qfmd3jcq2.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Under the BuildSpec section, Select <strong>Insert build commands</strong>.</li>\n<li>  Click <strong>Switch to editor</strong>.</li>\n<li>  In the Build commands, replace everything in there with the below.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">version</span><span class=\"pi\">:</span> <span class=\"m\">0.2</span>\n<span class=\"na\">phases</span><span class=\"pi\">:</span>\n  <span class=\"na\">install</span><span class=\"pi\">:</span>\n    <span class=\"na\">runtime-versions</span><span class=\"pi\">:</span>\n      <span class=\"na\">ruby</span><span class=\"pi\">:</span> <span class=\"m\">3.1</span>\n      <span class=\"c1\"># name: version</span>\n    <span class=\"na\">on-failure</span><span class=\"pi\">:</span> <span class=\"s\">ABORT</span>\n    <span class=\"na\">commands</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">pip3 install cfn-lint --quiet</span>\n      <span class=\"pi\">-</span> <span class=\"s\">apt-get install jq git -y -q</span>\n      <span class=\"pi\">-</span> <span class=\"s\">gem install cfn-nag</span>\n  <span class=\"na\">build</span><span class=\"pi\">:</span>\n    <span class=\"na\">on-failure</span><span class=\"pi\">:</span> <span class=\"s\">ABORT</span>\n    <span class=\"na\">commands</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">cd ./</span>\n      <span class=\"pi\">-</span> <span class=\"s\">cfn-lint cloudformation.yaml</span>\n      <span class=\"pi\">-</span> <span class=\"s\">cfn_nag_scan -i cloudformation.yaml</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Qq_PaYsZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wo7uhhy1iek8o4yqt4qq.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Qq_PaYsZ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wo7uhhy1iek8o4yqt4qq.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click <strong>Create build project</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"update-the-kms-key-policy-to-allow-the-codebuild-service-permissions\" href=\"#update-the-kms-key-policy-to-allow-the-codebuild-service-permissions\">\n  </a>\n  Update the KMS Key Policy to Allow the CodeBuild Service Permissions\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the KMS Service.</li>\n<li>  Click <strong>Customer managed keys</strong>.</li>\n<li>  Click <strong>Pipeline-Artifacts</strong>.</li>\n<li>  Click <strong>Switch to policy view</strong>\n</li>\n<li>  Click <strong>Edit</strong>.</li>\n<li>  Replace everything in the existing JSON Policy with the below.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"Version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2012-10-17\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"Statement\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Sid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Enable IAM User Permissions\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Tooling-Account-ID&gt;:root\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"kms:*\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Sid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow access for Key Administrators\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role&gt;\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Create*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Describe*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Enable*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:List*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Put*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Update*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Revoke*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Disable*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Get*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Delete*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:TagResource\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:UntagResource\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:ScheduleKeyDeletion\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:CancelKeyDeletion\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Sid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow use of the key\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                    </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:root\"</span><span class=\"p\">,</span><span class=\"w\">\n                    </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:root\"</span><span class=\"w\">\n                </span><span class=\"p\">],</span><span class=\"w\">\n                </span><span class=\"nl\">\"Service\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"codebuild.amazonaws.com\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Encrypt\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Decrypt\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:ReEncrypt*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:GenerateDataKey\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:DescribeKey\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n        </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above IAM Policy, replace <code>&lt;Tooling-Account-ID&gt;</code> with the Account ID of your own Tooling Account, replace <code>&lt;Development-Account-ID&gt;</code> with the Account ID of your own Development Account, replace <code>&lt;Production-Account-ID&gt;</code> with the Account ID of your own Production Account and replace <code>&lt;ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role&gt;</code> wih the ARN of the AWSReservedSSO_AdministratorAccess IAM Role that can be obtained from the IAM Console within the Tooling Account.</p>\n\n<ul>\n<li>  Click <strong>Save changes</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"update-the-codebuildbasepolicycloudformationtestseuwest2-iam-policy\" href=\"#update-the-codebuildbasepolicycloudformationtestseuwest2-iam-policy\">\n  </a>\n  Update the CodeBuildBasePolicy-CloudFormation-Tests-eu-west-2 IAM Policy\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.</li>\n<li>  Click <strong>Policies</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--pt41k43Q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b17ybvsow86rudt6zzmu.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--pt41k43Q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b17ybvsow86rudt6zzmu.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click the <strong>CodeBuildBasePolicy-CloudFormation-Tests-eu-west-2</strong> IAM Policy.</li>\n<li>  Click <strong>Edit policy</strong>.</li>\n<li>  Click the <strong>JSON</strong> Tab.</li>\n<li>  Replace everything in the existing JSON Policy with the below.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"Version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2012-10-17\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"Statement\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:logs:eu-west-2:&lt;Tooling-Account-ID&gt;:log-group:/aws/codebuild/CloudFormation-Tests\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:logs:eu-west-2:&lt;Tooling-Account-ID&gt;:log-group:/aws/codebuild/CloudFormation-Tests:*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"logs:CreateLogGroup\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"logs:CreateLogStream\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"logs:PutLogEvents\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:s3:::pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;/*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:PutObject\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:GetObject\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:GetObjectVersion\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:GetBucketAcl\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:GetBucketLocation\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:codecommit:eu-west-2:&lt;Tooling-Account-ID&gt;:CloudFormation-Repository\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:GitPull\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:CreateReportGroup\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:CreateReport\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:UpdateReport\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:BatchPutTestCases\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:BatchPutCodeCoverages\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:codebuild:eu-west-2:&lt;Tooling-Account-ID&gt;:report-group/CloudFormation-Tests-*\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:DescribeKey\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:GenerateDataKey\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Encrypt\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:ReEncrypt*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Decrypt\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"&lt;ARN-of-Pipeline-Artifacts-KMS-Key&gt;\"</span><span class=\"w\">\n            </span><span class=\"p\">]</span><span class=\"w\">\n        </span><span class=\"p\">}</span><span class=\"w\">        \n    </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above IAM Policy, replace <code>&lt;Tooling-Account-ID&gt;</code> with the Account ID of your own Tooling Account, replace <code>&lt;Development-Account-ID&gt;</code> with the Account ID of your own Development Account, replace <code>&lt;Production-Account-ID&gt;</code> with the Account ID of your own Production Account and replace <code>&lt;ARN-of-Pipeline-Artifacts-KMS-Key&gt;</code> wih the ARN of the Pipeline-Artifacts KMS Key that can be obtained from the KMS Console within the Tooling Account.</p>\n\n<ul>\n<li>  Click <strong>Review policy</strong>.</li>\n<li>  Click <strong>Save changes</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"create-the-deployment-pipeline-in-codepipeline\" href=\"#create-the-deployment-pipeline-in-codepipeline\">\n  </a>\n  Create the Deployment Pipeline in CodePipeline\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodePipeline Service.</li>\n<li>  Click <strong>Create pipeline</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hrrs2hzw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gaa1uqspdmvn638a52d6.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--hrrs2hzw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gaa1uqspdmvn638a52d6.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Choose pipeline settings page under the Pipeline settings section, In the Pipeline name type <strong>CloudFormation-Pipeline</strong>.</li>\n<li>  In the Service role, Select <strong>New service role</strong>.</li>\n<li>  In the Role name, Type <strong>CloudFormation-Pipeline</strong>.</li>\n<li>  Ensure that <strong>Allow AWS CodePipeline to create a service role so it can be used with this new pipeline</strong> is selected.</li>\n<li>  Expand the Advanced settings, Select <strong>Custom location</strong> for the Artifact Store.</li>\n<li>  In the Bucket, Select the <strong>pipeline-artifacts</strong> bucket that we previously created.</li>\n<li>  Select <strong>Customer Managed Key</strong> for the Encryption key.</li>\n<li>  In the KMS customer master key, Select the <strong>Pipeline-Artifacts</strong> KMS Key that we previously created.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--c4B6vglR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7qbumbdsufm3ucwa0062.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--c4B6vglR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7qbumbdsufm3ucwa0062.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click <strong>Next</strong>.</li>\n<li>  On the Add source stage page, In the Source provider select <strong>AWS CodeCommit</strong>.</li>\n<li>  In the Repository name, Select <strong>CloudFormation-Repository</strong>.</li>\n<li>  In the Branch name, Select <strong>main</strong>.</li>\n<li>  Leave all other settings as the defaults and Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--vXexWZYY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mwo8fpsj013y2kv676bu.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--vXexWZYY--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mwo8fpsj013y2kv676bu.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Add build stage page, In the Build provider select <strong>AWS CodeBuild</strong>.</li>\n<li>  In the Project name, Select <strong>CloudFormation-Tests</strong> and Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--I3XyOCnx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fqm1e5esm9qviuxzqba.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--I3XyOCnx--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fqm1e5esm9qviuxzqba.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Add deploy stage page, In the Deploy provider select <strong>AWS CloudFormation</strong>.</li>\n<li>  In the Action mode, Select <strong>Create or update a stack</strong>.</li>\n<li>  In the Stack name, Type <strong>Automated-CloudFormation-Deployment</strong>. <strong>Note:</strong> This can be named anything you'd like.</li>\n<li>  In the Artifact name, Select <strong>BuildArtifact</strong> and in the File name type <strong>cloudformation.yaml</strong>.</li>\n<li>  In the Capabilities - optional select <strong>CAPABILITY_NAMED_IAM</strong>.</li>\n<li>  In the Role name, Enter the <strong>ARN of the Development Accounts CloudFormation-Admin</strong> IAM Role and then Click <strong>Next</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6y1v0j3M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xcw81ipuvv4pt6zbg4rj.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6y1v0j3M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xcw81ipuvv4pt6zbg4rj.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  On the Review page, Click <strong>Create Pipeline</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"update-the-kms-key-policy-to-allow-the-cloudformationpipeline-iam-role-permissions\" href=\"#update-the-kms-key-policy-to-allow-the-cloudformationpipeline-iam-role-permissions\">\n  </a>\n  Update the KMS Key Policy to Allow the CloudFormation-Pipeline IAM Role Permissions\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the KMS Service.</li>\n<li>  Click <strong>Customer managed keys</strong>.</li>\n<li>  Click <strong>Pipeline-Artifacts</strong>.</li>\n<li>  Click <strong>Switch to policy view</strong>\n</li>\n<li>  Click <strong>Edit</strong>.</li>\n<li>  Replace everything in the existing JSON Policy with the below.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"Version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2012-10-17\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"Statement\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Sid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Enable IAM User Permissions\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Tooling-Account-ID&gt;:root\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"kms:*\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Sid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow access for Key Administrators\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role&gt;\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Create*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Describe*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Enable*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:List*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Put*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Update*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Revoke*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Disable*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Get*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Delete*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:TagResource\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:UntagResource\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:ScheduleKeyDeletion\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:CancelKeyDeletion\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Sid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow use of the key\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"Principal\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"AWS\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                    </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:root\"</span><span class=\"p\">,</span><span class=\"w\">\n                    </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:root\"</span><span class=\"p\">,</span><span class=\"w\">\n                    </span><span class=\"s2\">\"arn:aws:iam::&lt;Tooling-Account-ID&gt;:role/CloudFormation-Pipeline\"</span><span class=\"w\">\n                </span><span class=\"p\">],</span><span class=\"w\">\n                </span><span class=\"nl\">\"Service\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"codebuild.amazonaws.com\"</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Encrypt\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:Decrypt\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:ReEncrypt*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:GenerateDataKey\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"kms:DescribeKey\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n        </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above IAM Policy, replace <code>&lt;Tooling-Account-ID&gt;</code> with the Account ID of your own Tooling Account, replace <code>&lt;Development-Account-ID&gt;</code> with the Account ID of your own Development Account, replace <code>&lt;Production-Account-ID&gt;</code> with the Account ID of your own Production Account and replace <code>&lt;ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role&gt;</code> wih the ARN of the AWSReservedSSO_AdministratorAccess IAM Role that can be obtained from the IAM Console within the Tooling Account.</p>\n\n<ul>\n<li>  Click <strong>Save changes</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"update-the-cloudformationpipeline-iam-role-permissions\" href=\"#update-the-cloudformationpipeline-iam-role-permissions\">\n  </a>\n  Update the CloudFormation-Pipeline IAM Role Permissions\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.</li>\n<li>  Click <strong>Policies</strong>.</li>\n<li>  Click <strong>AWSCodePipelineServiceRole-eu-west-2-CloudFormation-Pipeline</strong>.</li>\n<li>  Click <strong>Edit policy</strong>.</li>\n<li>  Click the <strong>JSON</strong> Tab.</li>\n<li>  Replace everything in the existing JSON Policy with the below.\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"Version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2012-10-17\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"Statement\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"sts:AssumeRole\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:role/*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:role/*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Condition\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"StringEqualsIfExists\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                    </span><span class=\"nl\">\"iam:PassedToService\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                        </span><span class=\"s2\">\"cloudformation.amazonaws.com\"</span><span class=\"w\">\n                    </span><span class=\"p\">]</span><span class=\"w\">\n                </span><span class=\"p\">}</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"iam:PassRole\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:CancelUploadArchive\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:GetBranch\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:GetCommit\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:GetRepository\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:GetUploadArchiveStatus\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codecommit:UploadArchive\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudwatch:*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"s3:*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"sns:*\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:CreateStack\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:DeleteStack\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:DescribeStacks\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:UpdateStack\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:CreateChangeSet\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:DeleteChangeSet\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:DescribeChangeSet\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:ExecuteChangeSet\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:SetStackPolicy\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"cloudformation:ValidateTemplate\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"Action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:BatchGetBuildBatches\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:StartBuild\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:BatchGetBuilds\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"s2\">\"codebuild:StartBuildBatch\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Resource\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                </span><span class=\"s2\">\"*\"</span><span class=\"w\">\n            </span><span class=\"p\">],</span><span class=\"w\">\n            </span><span class=\"nl\">\"Effect\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Allow\"</span><span class=\"w\">\n        </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above IAM Policy, replace <code>&lt;Development-Account-ID&gt;</code> with the Account ID of your own Development Account and replace <code>&lt;Production-Account-ID&gt;</code> with the Account ID of your own Production Account</p>\n\n<ul>\n<li>  Click <strong>Review policy</strong>.</li>\n<li>  Click <strong>Save changes</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"update-the-deployment-pipeline-in-codepipeline-to-add-the-production-stage\" href=\"#update-the-deployment-pipeline-in-codepipeline-to-add-the-production-stage\">\n  </a>\n  Update the Deployment Pipeline in CodePipeline to Add the Production Stage\n</h3>\n\n<ul>\n<li>  In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodePipeline Service.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Sk9zV3Ql--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/k56gtioehi45ruhfep1z.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--Sk9zV3Ql--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/k56gtioehi45ruhfep1z.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click on <strong>CloudFormation-Pipeline</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--XQQxdy9t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9lksavgx79eaayrswn26.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--XQQxdy9t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9lksavgx79eaayrswn26.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click <strong>Edit</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--pQt3K66t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jh6bne3bwjyqff2oxy0z.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--pQt3K66t--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jh6bne3bwjyqff2oxy0z.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click on <strong>Add stage</strong> after the Deploy stage.</li>\n<li>  In the Stage name, Type <strong>Production</strong> and Click <strong>Add stage</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ZvlasmJv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p5jw31lp9ftqh4z8b1c5.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ZvlasmJv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p5jw31lp9ftqh4z8b1c5.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Under the Production stage, Click <strong>Add action group</strong>.</li>\n<li>  On the Edit action page, In Action name type <strong>Production</strong>.</li>\n<li>  In the Action provider, Select <strong>AWS CloudFormation</strong>.</li>\n<li>  In the Input artifacts, Select <strong>BuildArtifact</strong>.</li>\n<li>  In the Action mode, Select <strong>Create or update a stack</strong>.</li>\n<li>  In the Stack name, Type <strong>Automated-CloudFormation-Deployment</strong>.</li>\n<li>  In the Artifact name, Select <strong>BuildArtifact</strong>.</li>\n<li>  In the File name, Type <strong>cloudformation.yaml</strong>.</li>\n<li>  In Capabilities - optional, Select <strong>CAPABILITY_NAMED_IAM</strong>.</li>\n<li>  In the Role name, Enter the <strong>ARN of the Production Accounts CloudFormation-Admin</strong> IAM Role and then Click <strong>Done</strong>.</li>\n</ul>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--LCn3w6J3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/e7sar7tsqmrjbwqu4cw7.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--LCn3w6J3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/e7sar7tsqmrjbwqu4cw7.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<ul>\n<li>  Click <strong>Save</strong>.</li>\n</ul>\n\n<h3>\n  <a name=\"edit-the-deployment-pipeline-for-crossaccount-access\" href=\"#edit-the-deployment-pipeline-for-crossaccount-access\">\n  </a>\n  Edit the Deployment Pipeline for Cross-Account Access\n</h3>\n\n<ul>\n<li>  Execute a Get-Pipeline API Call using a Tooling Account profile via the AWS CLI using either a Command Prompt or from Powershell:\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>aws codepipeline get-pipeline --name CloudFormation-Pipeline --profile tooling &gt;&gt; pipeline.json\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<ul>\n<li>  Edit <strong>pipeline.json</strong> in a Code Editor to look something like the below:\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"pipeline\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CloudFormation-Pipeline\"</span><span class=\"p\">,</span><span class=\"w\">\n        </span><span class=\"nl\">\"roleArn\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Tooling-Account-ID&gt;:role/service-role/CloudFormation-Pipeline\"</span><span class=\"p\">,</span><span class=\"w\">\n        </span><span class=\"nl\">\"artifactStore\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n            </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"S3\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"location\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"pipeline-artifacts-eu-west-2-&lt;Tooling-Account-ID&gt;\"</span><span class=\"p\">,</span><span class=\"w\">\n            </span><span class=\"nl\">\"encryptionKey\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:kms:eu-west-2:&lt;Tooling-Account-ID&gt;:alias/Pipeline-Artifacts\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"KMS\"</span><span class=\"w\">\n            </span><span class=\"p\">}</span><span class=\"w\">\n        </span><span class=\"p\">},</span><span class=\"w\">\n        </span><span class=\"nl\">\"stages\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n            </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Source\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"nl\">\"actions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                    </span><span class=\"p\">{</span><span class=\"w\">\n                        </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Source\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"actionTypeId\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"category\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Source\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"owner\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"AWS\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"provider\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CodeCommit\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"runOrder\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"configuration\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"BranchName\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"main\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"OutputArtifactFormat\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CODE_ZIP\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"PollForSourceChanges\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"false\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"RepositoryName\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CloudFormation-Repository\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"outputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                            </span><span class=\"p\">{</span><span class=\"w\">\n                                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceArtifact\"</span><span class=\"w\">\n                            </span><span class=\"p\">}</span><span class=\"w\">\n                        </span><span class=\"p\">],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"inputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"region\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"eu-west-2\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"namespace\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceVariables\"</span><span class=\"w\">\n                    </span><span class=\"p\">}</span><span class=\"w\">\n                </span><span class=\"p\">]</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Build\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"nl\">\"actions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                    </span><span class=\"p\">{</span><span class=\"w\">\n                        </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Build\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"actionTypeId\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"category\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Build\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"owner\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"AWS\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"provider\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CodeBuild\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"runOrder\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"configuration\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"ProjectName\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CloudFormation-Tests\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"outputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                            </span><span class=\"p\">{</span><span class=\"w\">\n                                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"BuildArtifact\"</span><span class=\"w\">\n                            </span><span class=\"p\">}</span><span class=\"w\">\n                        </span><span class=\"p\">],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"inputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                            </span><span class=\"p\">{</span><span class=\"w\">\n                                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceArtifact\"</span><span class=\"w\">\n                            </span><span class=\"p\">}</span><span class=\"w\">\n                        </span><span class=\"p\">],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"region\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"eu-west-2\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"namespace\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"BuildVariables\"</span><span class=\"w\">\n                    </span><span class=\"p\">}</span><span class=\"w\">\n                </span><span class=\"p\">]</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Development-Environment\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"nl\">\"actions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                    </span><span class=\"p\">{</span><span class=\"w\">\n                        </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Deploy-to-Development\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"actionTypeId\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"category\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Deploy\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"owner\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"AWS\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"provider\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CloudFormation\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"runOrder\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"configuration\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"ActionMode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CREATE_UPDATE\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"Capabilities\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CAPABILITY_NAMED_IAM\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"RoleArn\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:role/CloudFormation-Admin\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"StackName\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Automated-CloudFormation-Deployment\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"TemplatePath\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceArtifact::cloudformation.yaml\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"outputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"inputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                            </span><span class=\"p\">{</span><span class=\"w\">\n                                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceArtifact\"</span><span class=\"w\">\n                            </span><span class=\"p\">}</span><span class=\"w\">\n                        </span><span class=\"p\">],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"roleArn\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Development-Account-ID&gt;:role/Cross-Account-Role\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"region\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"eu-west-2\"</span><span class=\"w\">\n                    </span><span class=\"p\">}</span><span class=\"w\">\n                </span><span class=\"p\">]</span><span class=\"w\">\n            </span><span class=\"p\">},</span><span class=\"w\">\n            </span><span class=\"p\">{</span><span class=\"w\">\n                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Production-Environment\"</span><span class=\"p\">,</span><span class=\"w\">\n                </span><span class=\"nl\">\"actions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                    </span><span class=\"p\">{</span><span class=\"w\">\n                        </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Deploy-to-Production\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"actionTypeId\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"category\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Deploy\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"owner\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"AWS\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"provider\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CloudFormation\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"runOrder\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"configuration\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n                            </span><span class=\"nl\">\"ActionMode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CREATE_UPDATE\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"Capabilities\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CAPABILITY_NAMED_IAM\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"RoleArn\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:role/CloudFormation-Admin\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"StackName\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Automated-CloudFormation-Deployment\"</span><span class=\"p\">,</span><span class=\"w\">\n                            </span><span class=\"nl\">\"TemplatePath\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceArtifact::cloudformation.yaml\"</span><span class=\"w\">\n                        </span><span class=\"p\">},</span><span class=\"w\">\n                        </span><span class=\"nl\">\"outputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"inputArtifacts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n                            </span><span class=\"p\">{</span><span class=\"w\">\n                                </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SourceArtifact\"</span><span class=\"w\">\n                            </span><span class=\"p\">}</span><span class=\"w\">\n                        </span><span class=\"p\">],</span><span class=\"w\">\n                        </span><span class=\"nl\">\"roleArn\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"arn:aws:iam::&lt;Production-Account-ID&gt;:role/Cross-Account-Role\"</span><span class=\"p\">,</span><span class=\"w\">\n                        </span><span class=\"nl\">\"region\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"eu-west-2\"</span><span class=\"w\">\n                    </span><span class=\"p\">}</span><span class=\"w\">\n                </span><span class=\"p\">]</span><span class=\"w\">\n            </span><span class=\"p\">}</span><span class=\"w\">\n        </span><span class=\"p\">],</span><span class=\"w\">\n        </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\">\n    </span><span class=\"p\">}</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n\n\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><strong>Note:</strong> In the above JSON, replace <code>&lt;Tooling-Account-ID&gt;</code> with the Account ID of your own Tooling Account, <code>&lt;Development-Account-ID&gt;</code> with the Account ID of your own Development Account and <code>&lt;Production-Account-ID&gt;</code> with the Account ID of your own Production Account.  We have also renamed the Stage that was originally displayed as <code>Deploy</code> to <code>Development</code> and we have also added the variable <code>roleArn</code> to both the Development and Production stages with the ARN of the Cross-Account-Role.</p>\n\n<ul>\n<li>  Execute a Get-Pipeline API Call using a Tooling Account profile via the AWS CLI using either a Command Prompt or from Powershell:\n</li>\n</ul>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>aws codepipeline update-pipeline --cli-input-json file://pipeline.json --profile tooling\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>If you then go into the CodePipeline Console and Click <strong>Release change</strong>, the pipeline will then trigger successfully.</p>\n\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ngttMxKM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2doy3v5hj4d5l8semuvr.png\" class=\"article-body-image-wrapper\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--ngttMxKM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2doy3v5hj4d5l8semuvr.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"473\"></a></p>\n\n<p>Hope this helps.</p>\n\n","body_markdown":"Whenever I've tried to learn a particular service or functionality within AWS, I find the best way is to do the ClickOps approach (i.e. Good Old Point and Click in the Console).  Once I've figured out how to get it working via that method, I then go through the process of trying to automate it through Infrastructure as Code and in my case thats using AWS CloudFormation.  \n\nOne particular example of this was getting a bit more familiar with AWS CodePipeline so that I could try to automate the delivery of CloudFormation Templates across multiple AWS Accounts in a similar manner as to how you would deploy solutions in a Software Delivery Lifecycle (SDLC).  When I was learning how to do this through the management console, I found out that its not possible to do it all within the console and therefore you have to also leverage the AWS CLI for specific parts.\n\nThis blog post aims to walkthrough the steps that you'd need to take to create a relatively simple CI/CD pipeline using the AWS CodeCommit, AWS CodeBuild and AWS CodePipeline so that we can deploy a simple CloudFormation template into multiple AWS Accounts via an automated manner.\n\nThe flow of the CI/CD pipeline will be as follows:\n*   A CloudFormation template gets committed to a CodeCommit repository.\n*   Upon the detection of changes in that repository the CodePipeline will trigger a deployment run.\n*   CodeBuild will run a linting check against the CloudFormation Template using <a href=\"https://github.com/aws-cloudformation/cfn-lint\" target=\"_blank\">cfn-lint</a> and will then run <a href=\"https://github.com/stelligent/cfn_nag\" target=\"_blank\">cfn-nag</a> to check for patterns that indicate insecure resources within the CloudFormation template.\n*   The CloudFormation template will then be deployed into the same AWS Account as where the CI/CD pipeline is.\n*   Finally the CloudFormation template will then be deployed into a different AWS Account.\n\nFor the purpose of this blog post I'm going to use 3 AWS Accounts - Tooling, Development & Production.  I'll be configuring the pipeline within the Tooling Account that will then deploy the CloudFormation Template into Development and then once an approval has been granted will then deploy to Production.\n\n### Create the CodeCommit Repository\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodeCommit Service.\n*   Click **Create repository**. \n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/goh1tc1p1gat8c5yupub.png)\n\n*   On the Create repository page, Enter a **CloudFormation-Repository** and Click **Create**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/l4z1lxyvaub4tyf7nxqb.png)\n\n### Configure an AWS CLI Profile to the Tooling Account\n*   Establish an AWS CLI Profile to the Management Account with administrative credentials via the AWS CLI using either a Command Prompt or from Powershell:\n```\naws configure sso\n```\n\n*   In the SSO start URL, type the **URL of the SSO Login page**. For example., https://d-1234567890.awsapps.com/start  This can be found by logging into the IAM Identity Center Console and looking for the AWS access portal URL in the Settings.\n*   In the SSO Region, type the **AWS Region** that was used for the Home Region when deploying Control Tower. For example., eu-west-2\n\nA Web Browser will then Open prompting for Login Credentials if you're not already logged in.  \n\n*   Login with your Username and Password.\n*   Click **Allow**.\n*   Select the **Tooling Account** using the cursor keys.\n*   Press **Return** for the default client Region and the default output format.\n*   For the Profile name use something memorable as this can be anything. For example., tooling\n\n### Clone the CodeCommit Repository\n*   Install the git-remote-codecommit module via either a Command Prompt or Powershell.\n```python\npip install git-remote-codecommit\n```\n\n*   Clone the CodeCommit repository via either a Command Prompt or Powershell. \n```\ngit clone codecommit://tooling@CloudFormation-Repository CloudFormation-Repository\n```\n**Note:** You'll need to ensure that you use the name of you AWS CLI profile prior to the `@` as shown in the example above.\n\n### Create the CloudFormation Template and Push to CodeCommit\n*   Create a file named **cloudformation.yaml**  with the below content in CloudFormation-Repository folder, where you cloned the repository to.\n```yaml\nAWSTemplateFormatVersion: 2010-09-09\nResources:\n  S3Bucket:\n    Type: AWS::S3::Bucket\n    Properties: \n      BucketName: automated-deployment-${AWS::Region}-${AWS::AccountId}\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: 'AES256'\n      PublicAccessBlockConfiguration:\n          BlockPublicAcls: true\n          BlockPublicPolicy: true\n          IgnorePublicAcls: true\n          RestrictPublicBuckets: true\n```\n\n*   Commit the Code to the CodeCommit Repository via either a Command Prompt or Powershell.\n```\ngit add .\ngit commit -m \"Initial Commit\"\ngit push\n```\n\n### Create the CloudFormation Service Role\n*   For both the Development and Production AWS Accounts follow the below steps.\n*   Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.\n*   Click **Roles**.\n*   Click **Create Role**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fmyzwl2y4iqt91fyjicu.png)\n\n*   On the Select trusted entity page, Ensure that the trusted entity is set to **AWS service** and then under Use cases for other AWS services, Select **CloudFormation** from the dropdown list and then Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lb2ztybhiq2jih4wujah.png)\n\n*   On the Add permission page, Select the **AdministratorAccess** from the Permissions policies and then Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7kcbd2tnq3cj7y6qiarj.png)\n\n*   On the Name, review and create page, In the Role Name type **CloudFormation-Admin** and then Click **Create role**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/fytfgnsuh3vgvszdj0q2.png)\n\n### Create the KMS Key for Pipeline Artifacts\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the KMS Service.\n*   Click **Create a key**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sazcs6xowcach7u7gn13.png)\n\n*   On the Configure key page, Leave the default options and Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/y9c1m7wejr8i4zs2fiog.png)\n\n*   On the Alias page, Create an Alias named **Pipeline-Artifacts** and Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5mabvixdlu32w3xzda71.png)\n\n*   On the Define key administrative permissions page, Select the Role that begins with the prefix of **AWSReservedSSO_AdministratorAccess**.\n*   Ensure that the Checkbox for Allow key administrators to delete this key is Selected and Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6zim14hgpkttcltr55tn.png)\n\n*   On the Define key usage permissions page, Click **Add another AWS Account**.\n*   Enter the 12 Digit Account ID of the Development Account and then Click **Add another AWS Account**.\n*   Enter the 12 Digit Account ID of the Production Account and then Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cissyipmcngr7d9kpqst.png)\n\n*   On the Review page, Click **Finish**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lv8fhnv899kbputs1ge9.png)\n\n### Create the S3 Bucket for Pipeline Artifacts\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the S3 Service.\n*   Click **Create bucket**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h8lq77iyyayutwez4pzh.png)\n\n*   On the Create bucket pagec, Enter a globall unique Bucket name.  In this example, I've suffixed the name pipeline-artifacts with the region and the AWS Account ID.\n*   Set the Bucket Versioning to **Enable**.\n*   Set the Default encryption to **Enable**, Select **AWS Key Management Service key (SSE-KMS)**, Select **Choose from your AWS KMS keys** and then Choose the KMS Key that we previously created.\n*   Click **Create bucket**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5p14xsaviy5ui1cpeodj.png)\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z62u99q2ejs5m6bf9gqv.png)\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/60fl0m307thxq4sj7mbp.png)\n\n*   In the S3 Service Console, Click **Buckets**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/bnokaptbrthxmd6omids.png)\n\n*   Click the **pipeline-artifacts** Bucket that we previously created.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mb86kig3khd9pcoho6a8.png)\n\n*   Click the **Permissions** Tab.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/5k0glriwfplo4sctaruj.png)\n\n*   Under the Bucket policy section, Click **Edit**. \n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b4ktmyjw8801eut0ql4t.png)\n\n*   Enter the below JSON Policy.\n\n```json\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Effect\": \"Deny\",\n            \"Principal\": \"*\",\n            \"Action\": [\n              \"s3:PutObject\"\n            ],\n            \"Resource\": [\n              \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>/*\"\n            ],\n            \"Condition\": {\n              \"StringNotEquals\": {\n                \"s3:x-amz-server-side-encryption\": \"aws:kms\"\n              }\n            }\n          },\n          {\n            \"Action\": \"s3:*\",\n            \"Effect\": \"Deny\",\n            \"Principal\": \"*\",\n            \"Resource\": [\n              \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>\",\n              \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>/*\"\n            ],\n            \"Condition\": {\n              \"Bool\": {\n                \"aws:SecureTransport\": false\n              }\n            }\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n              \"AWS\": [\n                \"arn:aws:iam::<Development-Account-ID>:root\",\n                \"arn:aws:iam::<Production-Account-ID>:root\"\n              ],\n              \"Service\": \"codebuild.amazonaws.com\"\n            },\n            \"Action\": [\n              \"s3:Get*\",\n              \"s3:Put*\"\n            ],\n            \"Resource\": [\n              \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>/*\"\n            ]\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n              \"AWS\": [\n                \"arn:aws:iam::<Development-Account-ID>:root\",\n                \"arn:aws:iam::<Production-Account-ID>:root\"\n              ],\n              \"Service\": \"codebuild.amazonaws.com\"\n            },\n            \"Action\": [\n              \"s3:ListBucket\"\n            ],\n            \"Resource\": [\n              \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>\"\n            ]\n          }\n        ]\n      }\n```\n**Note:** In the above IAM Policy, replace `<Tooling-Account-ID>` with the Account ID of your own Tooling Account, replace `<Development-Account-ID>` with the Account ID of your own Development Account, and replace `<Production-Account-ID>` with the Account ID of your own Production Account.\n\n*   Click **Save changes**.\n\n### Create the IAM Role for Cross-Account Access\n*   For both the Development and Production AWS Accounts follow the below steps.\n*   Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.\n*   Click **Roles**.\n*   Click **Create Role**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/f04zfo83atlnv54ohj7u.png)\n\n*   On the Select trusted entity page, Ensure that the trusted entity is set to **AWS account** and then under Another AWS account enter the 12 Digit Account ID for the Tooling Account and then Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/024zf1ut0otkzby4ielj.png)\n\n*   On the Add permission page, Click **Create policy**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/aie4qqx3jmg6em2p8wg8.png)\n\n*   On the Create policy page, Click the **JSON** Tab.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/egb366pw8ch9sobvdclb.png)\n\n*   Replace everything in the existing JSON Policy with the below.\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"kms:DescribeKey\",\n                \"kms:GenerateDataKey*\",\n                \"kms:Encrypt\",\n                \"kms:ReEncrypt*\",\n                \"kms:Decrypt\"\n            ],\n            \"Resource\": [\n                \"arn:aws:kms:eu-west-2:<Tooling-Account-ID>:key/*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"cloudformation:*\",\n                \"iam:PassRole\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"s3:Get*\",\n                \"s3:Put*\",\n                \"s3:ListBucket\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>/*\",\n                \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>\"\n            ],\n            \"Effect\": \"Allow\"\n        }\n    ]\n}\n```\n**Note:** In the above IAM Policy, replace `<Tooling-Account-ID>` with the Account ID of your own Tooling Account.\n\n*   Click **Next: Tags**.\n*   Click **Next: Review**.\n*   On the Review policy page, In the Policy name type **Pipeline-Cross-Account-Access** and Click **Create policy**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/34aq7zb588xng1j2e0w8.png)\n\nReturn to the Browser Tab for the Creation of the IAM Role and Click the **Refresh** Button.  The button with 2 Arrows on and then the IAM Policy that was just created will be visible.\n\n*   Select the **Pipeline-Cross-Account-Access** permissions policies and then Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/zzsti2vi27cy2kv6ihwn.png)\n\n*   On the Name, review, and create page, In the role name type **Cross-Account-Role** and Click **Create role**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mlpsxprrwl5ikenut8r0.png)\n\n### Create the CloudFormation Tests Build Project in CodeBuild\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodeBuild Service.\n*   Click **Create build project**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4dlyo9pt4joegel273qn.png)\n\n*   On the Create build project page under the Project configuration section, In the Project name type **CloudFormation-Tests**.\n*   Under the Source section, In the Source provider select **AWS CodeCommit**.\n*   In the Repository select **CloudFormation-Repository**.\n*   In the Branch select **main**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sve5rtbxag5oerslppf9.png)\n\n*   Under the Environment section, Select **Managed image**.\n*   In the Operating system, Select **Ubuntu**.\n*   In the Runtimes, Select **Standard**.\n*   In the Image, Select **aws/codebuild/standard:6.0**.\n*   In the Image version, Select **Always use the latest image for this runtime version**.\n*   In the Environment type, Select **Linux**.\n*   In the Service role, Select **New service role**.\n*   In the Role name, Type **CodeBuild-CloudFormation-Tests**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/r3t65g8wor9qfmd3jcq2.png)\n\n*   Under the BuildSpec section, Select **Insert build commands**.\n*   Click **Switch to editor**.\n*   In the Build commands, replace everything in there with the below.\n\n```yaml\nversion: 0.2\nphases:\n  install:\n    runtime-versions:\n      ruby: 3.1\n      # name: version\n    on-failure: ABORT\n    commands:\n      - pip3 install cfn-lint --quiet\n      - apt-get install jq git -y -q\n      - gem install cfn-nag\n  build:\n    on-failure: ABORT\n    commands:\n      - cd ./\n      - cfn-lint cloudformation.yaml\n      - cfn_nag_scan -i cloudformation.yaml\n```\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wo7uhhy1iek8o4yqt4qq.png)\n\n*   Click **Create build project**.\n\n### Update the KMS Key Policy to Allow the CodeBuild Service Permissions\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the KMS Service.\n*   Click **Customer managed keys**.\n*   Click **Pipeline-Artifacts**.\n*   Click **Switch to policy view**\n*   Click **Edit**.\n*   Replace everything in the existing JSON Policy with the below.\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Enable IAM User Permissions\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:aws:iam::<Tooling-Account-ID>:root\"\n            },\n            \"Action\": \"kms:*\",\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"Allow access for Key Administrators\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"<ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role>\"\n            },\n            \"Action\": [\n                \"kms:Create*\",\n                \"kms:Describe*\",\n                \"kms:Enable*\",\n                \"kms:List*\",\n                \"kms:Put*\",\n                \"kms:Update*\",\n                \"kms:Revoke*\",\n                \"kms:Disable*\",\n                \"kms:Get*\",\n                \"kms:Delete*\",\n                \"kms:TagResource\",\n                \"kms:UntagResource\",\n                \"kms:ScheduleKeyDeletion\",\n                \"kms:CancelKeyDeletion\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"Allow use of the key\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": [\n                    \"arn:aws:iam::<Development-Account-ID>:root\",\n                    \"arn:aws:iam::<Production-Account-ID>:root\"\n                ],\n                \"Service\": \"codebuild.amazonaws.com\"\n            },\n            \"Action\": [\n                \"kms:Encrypt\",\n                \"kms:Decrypt\",\n                \"kms:ReEncrypt*\",\n                \"kms:GenerateDataKey\",\n                \"kms:DescribeKey\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n**Note:** In the above IAM Policy, replace `<Tooling-Account-ID>` with the Account ID of your own Tooling Account, replace `<Development-Account-ID>` with the Account ID of your own Development Account, replace `<Production-Account-ID>` with the Account ID of your own Production Account and replace `<ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role>` wih the ARN of the AWSReservedSSO_AdministratorAccess IAM Role that can be obtained from the IAM Console within the Tooling Account.\n\n*   Click **Save changes**.\n\n### Update the CodeBuildBasePolicy-CloudFormation-Tests-eu-west-2 IAM Policy\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.\n*   Click **Policies**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b17ybvsow86rudt6zzmu.png)\n\n*   Click the **CodeBuildBasePolicy-CloudFormation-Tests-eu-west-2** IAM Policy.\n*   Click **Edit policy**.\n*   Click the **JSON** Tab.\n*   Replace everything in the existing JSON Policy with the below.\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Resource\": [\n                \"arn:aws:logs:eu-west-2:<Tooling-Account-ID>:log-group:/aws/codebuild/CloudFormation-Tests\",\n                \"arn:aws:logs:eu-west-2:<Tooling-Account-ID>:log-group:/aws/codebuild/CloudFormation-Tests:*\"\n            ],\n            \"Action\": [\n                \"logs:CreateLogGroup\",\n                \"logs:CreateLogStream\",\n                \"logs:PutLogEvents\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Resource\": [\n                \"arn:aws:s3:::pipeline-artifacts-eu-west-2-<Tooling-Account-ID>/*\"\n            ],\n            \"Action\": [\n                \"s3:PutObject\",\n                \"s3:GetObject\",\n                \"s3:GetObjectVersion\",\n                \"s3:GetBucketAcl\",\n                \"s3:GetBucketLocation\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Resource\": [\n                \"arn:aws:codecommit:eu-west-2:<Tooling-Account-ID>:CloudFormation-Repository\"\n            ],\n            \"Action\": [\n                \"codecommit:GitPull\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"codebuild:CreateReportGroup\",\n                \"codebuild:CreateReport\",\n                \"codebuild:UpdateReport\",\n                \"codebuild:BatchPutTestCases\",\n                \"codebuild:BatchPutCodeCoverages\"\n            ],\n            \"Resource\": [\n                \"arn:aws:codebuild:eu-west-2:<Tooling-Account-ID>:report-group/CloudFormation-Tests-*\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"kms:DescribeKey\",\n                \"kms:GenerateDataKey\",\n                \"kms:Encrypt\",\n                \"kms:ReEncrypt*\",\n                \"kms:Decrypt\"\n            ],\n            \"Resource\": [\n                \"<ARN-of-Pipeline-Artifacts-KMS-Key>\"\n            ]\n        }        \n    ]\n}\n```\n**Note:** In the above IAM Policy, replace `<Tooling-Account-ID>` with the Account ID of your own Tooling Account, replace `<Development-Account-ID>` with the Account ID of your own Development Account, replace `<Production-Account-ID>` with the Account ID of your own Production Account and replace `<ARN-of-Pipeline-Artifacts-KMS-Key>` wih the ARN of the Pipeline-Artifacts KMS Key that can be obtained from the KMS Console within the Tooling Account.\n\n*   Click **Review policy**.\n*   Click **Save changes**.\n\n### Create the Deployment Pipeline in CodePipeline\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodePipeline Service.\n*   Click **Create pipeline**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gaa1uqspdmvn638a52d6.png)\n\n*   On the Choose pipeline settings page under the Pipeline settings section, In the Pipeline name type **CloudFormation-Pipeline**.\n*   In the Service role, Select **New service role**.\n*   In the Role name, Type **CloudFormation-Pipeline**.\n*   Ensure that **Allow AWS CodePipeline to create a service role so it can be used with this new pipeline** is selected.\n*   Expand the Advanced settings, Select **Custom location** for the Artifact Store.\n*   In the Bucket, Select the **pipeline-artifacts** bucket that we previously created.\n*   Select **Customer Managed Key** for the Encryption key.\n*   In the KMS customer master key, Select the **Pipeline-Artifacts** KMS Key that we previously created.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7qbumbdsufm3ucwa0062.png)\n\n*   Click **Next**.\n*   On the Add source stage page, In the Source provider select **AWS CodeCommit**.\n*   In the Repository name, Select **CloudFormation-Repository**.\n*   In the Branch name, Select **main**.\n*   Leave all other settings as the defaults and Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mwo8fpsj013y2kv676bu.png)\n\n*   On the Add build stage page, In the Build provider select **AWS CodeBuild**.\n*   In the Project name, Select **CloudFormation-Tests** and Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8fqm1e5esm9qviuxzqba.png)\n\n*   On the Add deploy stage page, In the Deploy provider select **AWS CloudFormation**.\n*   In the Action mode, Select **Create or update a stack**.\n*   In the Stack name, Type **Automated-CloudFormation-Deployment**. **Note:** This can be named anything you'd like.\n*   In the Artifact name, Select **BuildArtifact** and in the File name type **cloudformation.yaml**.\n*   In the Capabilities - optional select **CAPABILITY_NAMED_IAM**.\n*   In the Role name, Enter the **ARN of the Development Accounts CloudFormation-Admin** IAM Role and then Click **Next**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xcw81ipuvv4pt6zbg4rj.png)\n\n*   On the Review page, Click **Create Pipeline**.\n\n### Update the KMS Key Policy to Allow the CloudFormation-Pipeline IAM Role Permissions\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the KMS Service.\n*   Click **Customer managed keys**.\n*   Click **Pipeline-Artifacts**.\n*   Click **Switch to policy view**\n*   Click **Edit**.\n*   Replace everything in the existing JSON Policy with the below.\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Enable IAM User Permissions\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:aws:iam::<Tooling-Account-ID>:root\"\n            },\n            \"Action\": \"kms:*\",\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"Allow access for Key Administrators\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"<ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role>\"\n            },\n            \"Action\": [\n                \"kms:Create*\",\n                \"kms:Describe*\",\n                \"kms:Enable*\",\n                \"kms:List*\",\n                \"kms:Put*\",\n                \"kms:Update*\",\n                \"kms:Revoke*\",\n                \"kms:Disable*\",\n                \"kms:Get*\",\n                \"kms:Delete*\",\n                \"kms:TagResource\",\n                \"kms:UntagResource\",\n                \"kms:ScheduleKeyDeletion\",\n                \"kms:CancelKeyDeletion\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"Allow use of the key\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": [\n                    \"arn:aws:iam::<Development-Account-ID>:root\",\n                    \"arn:aws:iam::<Production-Account-ID>:root\",\n                    \"arn:aws:iam::<Tooling-Account-ID>:role/CloudFormation-Pipeline\"\n                ],\n                \"Service\": \"codebuild.amazonaws.com\"\n            },\n            \"Action\": [\n                \"kms:Encrypt\",\n                \"kms:Decrypt\",\n                \"kms:ReEncrypt*\",\n                \"kms:GenerateDataKey\",\n                \"kms:DescribeKey\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n**Note:** In the above IAM Policy, replace `<Tooling-Account-ID>` with the Account ID of your own Tooling Account, replace `<Development-Account-ID>` with the Account ID of your own Development Account, replace `<Production-Account-ID>` with the Account ID of your own Production Account and replace `<ARN-of-AWSReservedSSO_AdministratorAccess-IAM-Role>` wih the ARN of the AWSReservedSSO_AdministratorAccess IAM Role that can be obtained from the IAM Console within the Tooling Account.\n\n*   Click **Save changes**.\n\n### Update the CloudFormation-Pipeline IAM Role Permissions\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the IAM Service.\n*   Click **Policies**.\n*   Click **AWSCodePipelineServiceRole-eu-west-2-CloudFormation-Pipeline**.\n*   Click **Edit policy**.\n*   Click the **JSON** Tab.\n*   Replace everything in the existing JSON Policy with the below.\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"sts:AssumeRole\"\n            ],\n            \"Resource\": [\n                \"arn:aws:iam::<Development-Account-ID>:role/*\",\n                \"arn:aws:iam::<Production-Account-ID>:role/*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Condition\": {\n                \"StringEqualsIfExists\": {\n                    \"iam:PassedToService\": [\n                        \"cloudformation.amazonaws.com\"\n                    ]\n                }\n            },\n            \"Action\": [\n                \"iam:PassRole\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"codecommit:CancelUploadArchive\",\n                \"codecommit:GetBranch\",\n                \"codecommit:GetCommit\",\n                \"codecommit:GetRepository\",\n                \"codecommit:GetUploadArchiveStatus\",\n                \"codecommit:UploadArchive\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"cloudwatch:*\",\n                \"s3:*\",\n                \"sns:*\",\n                \"cloudformation:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"cloudformation:CreateStack\",\n                \"cloudformation:DeleteStack\",\n                \"cloudformation:DescribeStacks\",\n                \"cloudformation:UpdateStack\",\n                \"cloudformation:CreateChangeSet\",\n                \"cloudformation:DeleteChangeSet\",\n                \"cloudformation:DescribeChangeSet\",\n                \"cloudformation:ExecuteChangeSet\",\n                \"cloudformation:SetStackPolicy\",\n                \"cloudformation:ValidateTemplate\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"codebuild:BatchGetBuildBatches\",\n                \"codebuild:StartBuild\",\n                \"codebuild:BatchGetBuilds\",\n                \"codebuild:StartBuildBatch\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ],\n            \"Effect\": \"Allow\"\n        }\n    ]\n}\n```\n**Note:** In the above IAM Policy, replace `<Development-Account-ID>` with the Account ID of your own Development Account and replace `<Production-Account-ID>` with the Account ID of your own Production Account\n\n*   Click **Review policy**.\n*   Click **Save changes**.\n\n### Update the Deployment Pipeline in CodePipeline to Add the Production Stage\n*   In the Tooling Account, Login to the AWS Management Console using an Account with administrative permissions and navigate to the CodePipeline Service.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/k56gtioehi45ruhfep1z.png)\n\n*   Click on **CloudFormation-Pipeline**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9lksavgx79eaayrswn26.png)\n\n*   Click **Edit**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jh6bne3bwjyqff2oxy0z.png)\n\n*   Click on **Add stage** after the Deploy stage.\n*   In the Stage name, Type **Production** and Click **Add stage**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/p5jw31lp9ftqh4z8b1c5.png)\n\n*   Under the Production stage, Click **Add action group**.\n*   On the Edit action page, In Action name type **Production**.\n*   In the Action provider, Select **AWS CloudFormation**.\n*   In the Input artifacts, Select **BuildArtifact**.\n*   In the Action mode, Select **Create or update a stack**.\n*   In the Stack name, Type **Automated-CloudFormation-Deployment**.\n*   In the Artifact name, Select **BuildArtifact**.\n*   In the File name, Type **cloudformation.yaml**.\n*   In Capabilities - optional, Select **CAPABILITY_NAMED_IAM**.\n*   In the Role name, Enter the **ARN of the Production Accounts CloudFormation-Admin** IAM Role and then Click **Done**.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/e7sar7tsqmrjbwqu4cw7.png)\n\n*   Click **Save**.\n\n### Edit the Deployment Pipeline for Cross-Account Access\n*   Execute a Get-Pipeline API Call using a Tooling Account profile via the AWS CLI using either a Command Prompt or from Powershell:\n```\naws codepipeline get-pipeline --name CloudFormation-Pipeline --profile tooling >> pipeline.json\n```\n\n*   Edit **pipeline.json** in a Code Editor to look something like the below:\n\n```json\n{\n    \"pipeline\": {\n        \"name\": \"CloudFormation-Pipeline\",\n        \"roleArn\": \"arn:aws:iam::<Tooling-Account-ID>:role/service-role/CloudFormation-Pipeline\",\n        \"artifactStore\": {\n            \"type\": \"S3\",\n            \"location\": \"pipeline-artifacts-eu-west-2-<Tooling-Account-ID>\",\n            \"encryptionKey\": {\n                \"id\": \"arn:aws:kms:eu-west-2:<Tooling-Account-ID>:alias/Pipeline-Artifacts\",\n                \"type\": \"KMS\"\n            }\n        },\n        \"stages\": [\n            {\n                \"name\": \"Source\",\n                \"actions\": [\n                    {\n                        \"name\": \"Source\",\n                        \"actionTypeId\": {\n                            \"category\": \"Source\",\n                            \"owner\": \"AWS\",\n                            \"provider\": \"CodeCommit\",\n                            \"version\": \"1\"\n                        },\n                        \"runOrder\": 1,\n                        \"configuration\": {\n                            \"BranchName\": \"main\",\n                            \"OutputArtifactFormat\": \"CODE_ZIP\",\n                            \"PollForSourceChanges\": \"false\",\n                            \"RepositoryName\": \"CloudFormation-Repository\"\n                        },\n                        \"outputArtifacts\": [\n                            {\n                                \"name\": \"SourceArtifact\"\n                            }\n                        ],\n                        \"inputArtifacts\": [],\n                        \"region\": \"eu-west-2\",\n                        \"namespace\": \"SourceVariables\"\n                    }\n                ]\n            },\n            {\n                \"name\": \"Build\",\n                \"actions\": [\n                    {\n                        \"name\": \"Build\",\n                        \"actionTypeId\": {\n                            \"category\": \"Build\",\n                            \"owner\": \"AWS\",\n                            \"provider\": \"CodeBuild\",\n                            \"version\": \"1\"\n                        },\n                        \"runOrder\": 1,\n                        \"configuration\": {\n                            \"ProjectName\": \"CloudFormation-Tests\"\n                        },\n                        \"outputArtifacts\": [\n                            {\n                                \"name\": \"BuildArtifact\"\n                            }\n                        ],\n                        \"inputArtifacts\": [\n                            {\n                                \"name\": \"SourceArtifact\"\n                            }\n                        ],\n                        \"region\": \"eu-west-2\",\n                        \"namespace\": \"BuildVariables\"\n                    }\n                ]\n            },\n            {\n                \"name\": \"Development-Environment\",\n                \"actions\": [\n                    {\n                        \"name\": \"Deploy-to-Development\",\n                        \"actionTypeId\": {\n                            \"category\": \"Deploy\",\n                            \"owner\": \"AWS\",\n                            \"provider\": \"CloudFormation\",\n                            \"version\": \"1\"\n                        },\n                        \"runOrder\": 1,\n                        \"configuration\": {\n                            \"ActionMode\": \"CREATE_UPDATE\",\n                            \"Capabilities\": \"CAPABILITY_NAMED_IAM\",\n                            \"RoleArn\": \"arn:aws:iam::<Development-Account-ID>:role/CloudFormation-Admin\",\n                            \"StackName\": \"Automated-CloudFormation-Deployment\",\n                            \"TemplatePath\": \"SourceArtifact::cloudformation.yaml\"\n                        },\n                        \"outputArtifacts\": [],\n                        \"inputArtifacts\": [\n                            {\n                                \"name\": \"SourceArtifact\"\n                            }\n                        ],\n                        \"roleArn\": \"arn:aws:iam::<Development-Account-ID>:role/Cross-Account-Role\",\n                        \"region\": \"eu-west-2\"\n                    }\n                ]\n            },\n            {\n                \"name\": \"Production-Environment\",\n                \"actions\": [\n                    {\n                        \"name\": \"Deploy-to-Production\",\n                        \"actionTypeId\": {\n                            \"category\": \"Deploy\",\n                            \"owner\": \"AWS\",\n                            \"provider\": \"CloudFormation\",\n                            \"version\": \"1\"\n                        },\n                        \"runOrder\": 2,\n                        \"configuration\": {\n                            \"ActionMode\": \"CREATE_UPDATE\",\n                            \"Capabilities\": \"CAPABILITY_NAMED_IAM\",\n                            \"RoleArn\": \"arn:aws:iam::<Production-Account-ID>:role/CloudFormation-Admin\",\n                            \"StackName\": \"Automated-CloudFormation-Deployment\",\n                            \"TemplatePath\": \"SourceArtifact::cloudformation.yaml\"\n                        },\n                        \"outputArtifacts\": [],\n                        \"inputArtifacts\": [\n                            {\n                                \"name\": \"SourceArtifact\"\n                            }\n                        ],\n                        \"roleArn\": \"arn:aws:iam::<Production-Account-ID>:role/Cross-Account-Role\",\n                        \"region\": \"eu-west-2\"\n                    }\n                ]\n            }\n        ],\n        \"version\": 1\n    }\n}\n\n\n```\n**Note:** In the above JSON, replace `<Tooling-Account-ID>` with the Account ID of your own Tooling Account, `<Development-Account-ID>` with the Account ID of your own Development Account and `<Production-Account-ID>` with the Account ID of your own Production Account.  We have also renamed the Stage that was originally displayed as `Deploy` to `Development` and we have also added the variable `roleArn` to both the Development and Production stages with the ARN of the Cross-Account-Role.\n\n*   Execute a Get-Pipeline API Call using a Tooling Account profile via the AWS CLI using either a Command Prompt or from Powershell:\n```\naws codepipeline update-pipeline --cli-input-json file://pipeline.json --profile tooling\n```\n\nIf you then go into the CodePipeline Console and Click **Release change**, the pipeline will then trigger successfully.\n\n![Image description](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2doy3v5hj4d5l8semuvr.png)\n\nHope this helps.","user":{"name":"Adam Divall","username":"adamdivall","twitter_username":"AdamDivall","github_username":"AdamDivall","user_id":918193,"website_url":"https://adamdivall.co.uk","profile_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--No1Y8c7H--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/918193/8df24ccb-dec9-4bb0-af1b-63033a1b5894.jpeg","profile_image_90":"https://res.cloudinary.com/practicaldev/image/fetch/s---Dom7jDB--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/918193/8df24ccb-dec9-4bb0-af1b-63033a1b5894.jpeg"}}