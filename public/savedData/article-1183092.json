{"type_of":"article","id":1183092,"title":"Graphql mutations with github gql api : follow and unfollow a user","description":"Graphql mutations            using the github graphql api with react-query   we'll use...","readable_publish_date":"Sep 3","slug":"graphql-mutations-with-github-gql-api-follow-and-unfollow-a-user-7pk","path":"/tigawanna/graphql-mutations-with-github-gql-api-follow-and-unfollow-a-user-7pk","url":"https://dev.to/tigawanna/graphql-mutations-with-github-gql-api-follow-and-unfollow-a-user-7pk","comments_count":0,"public_reactions_count":3,"collection_id":null,"published_timestamp":"2022-09-03T10:44:50Z","positive_reactions_count":3,"cover_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--aptK6qCu--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jdwdst6buccvyb5znxa4.png","social_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--zKGumU36--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/jdwdst6buccvyb5znxa4.png","canonical_url":"https://dev.to/tigawanna/graphql-mutations-with-github-gql-api-follow-and-unfollow-a-user-7pk","created_at":"2022-09-03T10:44:50Z","edited_at":"2022-09-03T10:47:48Z","crossposted_at":null,"published_at":"2022-09-03T10:44:50Z","last_comment_at":"2022-09-03T10:44:50Z","reading_time_minutes":1,"tag_list":"reactquery, graphql, github, api","tags":["reactquery","graphql","github","api"],"body_html":"<h1>\n  <a name=\"graphql-mutations\" href=\"#graphql-mutations\">\n  </a>\n  Graphql mutations\n</h1>\n\n<h2>\n  <a name=\"using-the-github-graphql-api-with-reactquery\" href=\"#using-the-github-graphql-api-with-reactquery\">\n  </a>\n  using the github graphql api with react-query\n</h2>\n\n<p>we'll use follow and unfollow user mutations<br>\nit takes in parmeter<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"nx\">input</span><span class=\"p\">:</span><span class=\"nx\">FollowUserInput</span><span class=\"o\">|</span><span class=\"nx\">UnfollowUserInput</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>which has the fields<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"p\">{</span><span class=\"nl\">userId</span><span class=\"p\">:</span><span class=\"nb\">String</span><span class=\"o\">!</span> <span class=\"p\">,</span><span class=\"nx\">clientMutationId</span><span class=\"p\">:</span><span class=\"nb\">String</span><span class=\"p\">}</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>so we'll be passing in the userId which we'll get from the user as id , we can ignore clientMutationId since it's not required</p>\n\n<h2>\n  <a name=\"the-mutations\" href=\"#the-mutations\">\n  </a>\n  the mutations\n</h2>\n\n\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"k\">import</span> <span class=\"nx\">gql</span> <span class=\"k\">from</span> <span class=\"dl\">\"</span><span class=\"s2\">graphql-tag</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">FOLLOWUSER</span> <span class=\"o\">=</span> <span class=\"nx\">gql</span><span class=\"s2\">`\n  mutation followUser($input: FollowUserInput!) {\n    followUser(input: $input) {\n      clientMutationId\n    }\n  }\n`</span><span class=\"p\">;</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">UNFOLLOWUSER</span> <span class=\"o\">=</span> <span class=\"nx\">gql</span><span class=\"s2\">`\nmutation unfollowUser($input:UnfollowUserInput!){\n  unfollowUser(input:$input){\n    clientMutationId\n  }\n}\n`</span><span class=\"p\">;</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h2>\n  <a name=\"custom-usegqlmutatin\" href=\"#custom-usegqlmutatin\">\n  </a>\n  custom usegQLmutatin\n</h2>\n\n\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">useMutation</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">\"</span><span class=\"s2\">react-query</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">GraphQLClient</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">\"</span><span class=\"s2\">graphql-request</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n<span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">DocumentNode</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">\"</span><span class=\"s2\">graphql</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">useGQLmutation</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n  <span class=\"nx\">token</span><span class=\"p\">:</span> <span class=\"kr\">string</span><span class=\"p\">,</span>\n  <span class=\"nx\">mutation</span><span class=\"p\">:</span> <span class=\"nx\">DocumentNode</span><span class=\"p\">,</span>\n  <span class=\"nx\">config</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">endpoint</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">https://api.github.com/graphql</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">headers</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"na\">headers</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"na\">Authorization</span><span class=\"p\">:</span> <span class=\"s2\">`Bearer </span><span class=\"p\">${</span><span class=\"nx\">token</span><span class=\"p\">}</span><span class=\"s2\">`</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">Content-Type</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">application/json</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n  <span class=\"p\">};</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">graphQLClient</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">GraphQLClient</span><span class=\"p\">(</span><span class=\"nx\">endpoint</span><span class=\"p\">,</span> <span class=\"nx\">headers</span><span class=\"p\">);</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">fetchData</span> <span class=\"o\">=</span> <span class=\"k\">async</span> <span class=\"p\">(</span><span class=\"na\">vars</span><span class=\"p\">:</span> <span class=\"kr\">any</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n     <span class=\"k\">return</span> <span class=\"k\">await</span> <span class=\"nx\">graphQLClient</span><span class=\"p\">.</span><span class=\"nx\">request</span><span class=\"p\">(</span><span class=\"nx\">mutation</span><span class=\"p\">,</span><span class=\"nx\">vars</span><span class=\"p\">);</span>\n   <span class=\"p\">};</span>\n\n   <span class=\"k\">return</span> <span class=\"nx\">useMutation</span><span class=\"p\">((</span><span class=\"na\">vars</span><span class=\"p\">:</span><span class=\"kr\">any</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span><span class=\"k\">return</span> <span class=\"nx\">fetchData</span><span class=\"p\">(</span><span class=\"nx\">vars</span><span class=\"p\">)},</span><span class=\"nx\">config</span><span class=\"p\">);</span>\n\n<span class=\"p\">};</span>\n\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h2>\n  <a name=\"usage-in-the-project\" href=\"#usage-in-the-project\">\n  </a>\n  usage in the project\n</h2>\n\n\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"kd\">const</span> <span class=\"nx\">followMutation</span> <span class=\"o\">=</span> <span class=\"nx\">useGQLmutation</span><span class=\"p\">(</span><span class=\"nx\">token</span><span class=\"p\">,</span><span class=\"nx\">FOLLOWUSER</span><span class=\"p\">)</span>\n<span class=\"kd\">const</span> <span class=\"nx\">unfollowMutation</span> <span class=\"o\">=</span> <span class=\"nx\">useGQLmutation</span><span class=\"p\">(</span><span class=\"nx\">token</span><span class=\"p\">,</span><span class=\"nx\">UNFOLLOWUSER</span><span class=\"p\">)</span>\n<span class=\"kd\">const</span> <span class=\"p\">[</span><span class=\"nx\">yes</span><span class=\"p\">,</span> <span class=\"nx\">setYes</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">useState</span><span class=\"o\">&lt;</span><span class=\"kr\">any</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"nx\">dev</span><span class=\"p\">?.</span><span class=\"nx\">viewerIsFollowing</span><span class=\"p\">);</span>\n\n<span class=\"kd\">const</span> <span class=\"nx\">followThem</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">their_id</span><span class=\"p\">:</span> <span class=\"kr\">string</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">setYes</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n    <span class=\"c1\">// followUser(their_name, token);</span>\n    <span class=\"nx\">followMutation</span><span class=\"p\">.</span><span class=\"nx\">mutate</span><span class=\"p\">({</span><span class=\"na\">input</span><span class=\"p\">:{</span><span class=\"na\">userId</span><span class=\"p\">:</span><span class=\"nx\">their_id</span><span class=\"p\">}})</span>\n  <span class=\"p\">};</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">unfollowThem</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">their_id</span><span class=\"p\">:</span> <span class=\"kr\">string</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n    <span class=\"nx\">setYes</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">);</span>\n    <span class=\"c1\">// unfollowUser(their_name, token);</span>\n    <span class=\"nx\">unfollowMutation</span><span class=\"p\">.</span><span class=\"nx\">mutate</span><span class=\"p\">({</span><span class=\"na\">input</span><span class=\"p\">:{</span><span class=\"na\">userId</span><span class=\"p\">:</span><span class=\"nx\">their_id</span><span class=\"p\">}})</span>\n  <span class=\"p\">};</span>\n\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><a href=\"https://github.com/tigawanna/gitdeck\">full project</a><br>\n<a href=\"https://gitdeck-two.vercel.app/\">live preview</a></p>\n\n","body_markdown":"# Graphql mutations \n## using the github graphql api with react-query\n\nwe'll use follow and unfollow user mutations\nit takes in parmeter \n```ts\ninput:FollowUserInput|UnfollowUserInput\n```\nwhich has the fields \n\n```ts\n{userId:String! ,clientMutationId:String}\n```\nso we'll be passing in the userId which we'll get from the user as id , we can ignore clientMutationId since it's not required\n\n## the mutations\n\n```ts\nimport gql from \"graphql-tag\";\n\nexport const FOLLOWUSER = gql`\n  mutation followUser($input: FollowUserInput!) {\n    followUser(input: $input) {\n      clientMutationId\n    }\n  }\n`;\n\nexport const UNFOLLOWUSER = gql`\nmutation unfollowUser($input:UnfollowUserInput!){\n  unfollowUser(input:$input){\n    clientMutationId\n  }\n}\n`;\n```\n\n## custom usegQLmutatin\n\n```ts\nimport { useMutation } from \"react-query\";\nimport { GraphQLClient } from \"graphql-request\";\nimport { DocumentNode } from \"graphql\";\n\nexport const useGQLmutation = (\n  token: string,\n  mutation: DocumentNode,\n  config = {}\n) => {\n  const endpoint = \"https://api.github.com/graphql\";\n  const headers = {\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\",\n    },\n  };\n  const graphQLClient = new GraphQLClient(endpoint, headers);\n  const fetchData = async (vars: any) => {\n     return await graphQLClient.request(mutation,vars);\n   };\n  \n   return useMutation((vars:any) => {return fetchData(vars)},config);\n\n};\n\n```\n\n## usage in the project\n\n```ts\nconst followMutation = useGQLmutation(token,FOLLOWUSER)\nconst unfollowMutation = useGQLmutation(token,UNFOLLOWUSER)\nconst [yes, setYes] = useState<any>(dev?.viewerIsFollowing);\n\nconst followThem = (their_id: string) => {\n    setYes(true);\n    // followUser(their_name, token);\n    followMutation.mutate({input:{userId:their_id}})\n  };\n  const unfollowThem = (their_id: string) => {\n    setYes(false);\n    // unfollowUser(their_name, token);\n    unfollowMutation.mutate({input:{userId:their_id}})\n  };\n\n```\n[full project](https://github.com/tigawanna/gitdeck)\n[live preview](https://gitdeck-two.vercel.app/)\n\n\n\n","user":{"name":"Dennis kinuthia","username":"tigawanna","twitter_username":null,"github_username":"tigawanna","user_id":859413,"website_url":"https://next-portfolio-zeta-two.vercel.app/","profile_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--YRgdYRhd--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/859413/f6b53ee1-f613-4efe-af59-422c7eeac07a.jpeg","profile_image_90":"https://res.cloudinary.com/practicaldev/image/fetch/s--4hEd67-Y--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/859413/f6b53ee1-f613-4efe-af59-422c7eeac07a.jpeg"}}