{"type_of":"article","id":1176144,"title":"Publier une librairie avec plusieurs packages à l'aide de Turborepo","description":"Plusieurs packages ?   Maintenant que nous savons publier un package sur npm, nous allons...","readable_publish_date":"Nov 7","slug":"publier-plusieurs-packages-avec-turborepo-2lo4","path":"/simonboisset/publier-plusieurs-packages-avec-turborepo-2lo4","url":"https://dev.to/simonboisset/publier-plusieurs-packages-avec-turborepo-2lo4","comments_count":0,"public_reactions_count":2,"collection_id":20012,"published_timestamp":"2022-11-07T10:16:22Z","positive_reactions_count":2,"cover_image":null,"social_image":"https://dev.to/social_previews/article/1176144.png","canonical_url":"https://dev.to/simonboisset/publier-plusieurs-packages-avec-turborepo-2lo4","created_at":"2022-08-25T15:11:41Z","edited_at":"2022-11-07T10:25:16Z","crossposted_at":null,"published_at":"2022-11-07T10:16:22Z","last_comment_at":"2022-11-07T10:16:22Z","reading_time_minutes":3,"tag_list":"turborepo, npm, typescript, javascript","tags":["turborepo","npm","typescript","javascript"],"body_html":"<h1>\n  <a name=\"plusieurs-packages-\" href=\"#plusieurs-packages-\">\n  </a>\n  Plusieurs packages ?\n</h1>\n\n<p>Maintenant que nous savons publier un package sur npm, nous allons voir comment gérer une librairie qui comporte plusieurs packages.</p>\n\n<p>Vous pouvez consulter <a href=\"https://github.com/simonboisset/validest\">cet exemple</a> pour voir une application concrète.</p>\n\n<h1>\n  <a name=\"configuration\" href=\"#configuration\">\n  </a>\n  Configuration\n</h1>\n\n<p>Pour gérer plusieurs modules ensemble nous allons utiliser Turborepo que vous avez déjà pu voir dans d'un article précédent.<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>npx create-turbo@latest\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Vous pouvez supprimer les différents exemples de packages de base, nous allons créer les nôtres par la suite.</p>\n\n<h1>\n  <a name=\"builder\" href=\"#builder\">\n  </a>\n  Builder\n</h1>\n\n<p>On va commencer par créer un package pour gérer les builds de nos librairies. Celui-ci ne sera pas publié mais uniquement partagé dans notre monorepo.</p>\n\n<p>Créez un dossier <code>builder</code> dans <code>packages</code> puis créez les fichiers suivants : </p>\n\n<p><code>package.json</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"builder\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"private\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"bin\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"index.js\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"dependencies\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nl\">\"esbuild\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^0.14.42\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nl\">\"esbuild-node-externals\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^1.4.1\"</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><code>index.js</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight javascript\"><code><span class=\"cp\">#!/usr/bin/env node\n</span>\n<span class=\"kd\">const</span> <span class=\"nx\">esbuild</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">esbuild</span><span class=\"dl\">'</span><span class=\"p\">);</span>\n<span class=\"kd\">const</span> <span class=\"p\">{</span> <span class=\"nx\">nodeExternalsPlugin</span> <span class=\"p\">}</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">esbuild-node-externals</span><span class=\"dl\">'</span><span class=\"p\">);</span>\n<span class=\"nx\">esbuild</span>\n  <span class=\"p\">.</span><span class=\"nx\">build</span><span class=\"p\">({</span>\n    <span class=\"na\">entryPoints</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">./src/index.ts</span><span class=\"dl\">'</span><span class=\"p\">],</span>\n    <span class=\"na\">outfile</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">dist/index.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"na\">bundle</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"na\">minify</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"na\">treeShaking</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"na\">platform</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">node</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"na\">format</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">cjs</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"na\">target</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">node14</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"na\">plugins</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"nx\">nodeExternalsPlugin</span><span class=\"p\">()],</span>\n  <span class=\"p\">})</span>\n  <span class=\"p\">.</span><span class=\"k\">catch</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">));</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h1>\n  <a name=\"nos-packages\" href=\"#nos-packages\">\n  </a>\n  Nos packages\n</h1>\n\n<p>Maintenant nous pouvons créer nos différents packages. Pour l'exemple nous allons en créer deux.</p>\n\n<h2>\n  <a name=\"core\" href=\"#core\">\n  </a>\n  Core\n</h2>\n\n<p>Toujours dans le dossier <code>packages</code> on va créer un dossier <code>core</code> et les fichiers suivants :</p>\n\n<p><code>package.json</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"@example/core\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"description\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"A description\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"main\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"dist/index.js\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"typings\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"dist/index.d.ts\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"files\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"dist\"</span><span class=\"p\">],</span><span class=\"w\">\n  </span><span class=\"nl\">\"scripts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"build\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"rm -rf dist &amp;&amp; builder &amp;&amp; tsc\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"p\">},</span><span class=\"w\">\n  </span><span class=\"nl\">\"author\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Your name\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"license\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"MIT\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"devDependencies\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"builder\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"*\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"typescript\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^4.7.4\"</span><span class=\"w\">\n  </span><span class=\"p\">}</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<blockquote>\n<p>Vous remarquerez que nous avons utilisé un scope pour notre nom de package <code>@example</code>. Pour utiliser le votre vous devez créer une organisation du même nom sur npm.</p>\n</blockquote>\n\n<p><code>src/index.ts</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">hello</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">:</span> <span class=\"kr\">string</span><span class=\"p\">)</span><span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n   <span class=\"k\">return</span> <span class=\"dl\">'</span><span class=\"s1\">Hello </span><span class=\"dl\">'</span> <span class=\"o\">+</span> <span class=\"nx\">name</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><code>tsconfig.json</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nl\">\"extends\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"builder/ts.json\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"include\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"src\"</span><span class=\"p\">],</span><span class=\"w\">\n  </span><span class=\"nl\">\"exclude\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"src/**/*.test.ts\"</span><span class=\"p\">],</span><span class=\"w\">\n  </span><span class=\"nl\">\"compilerOptions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"outDir\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"dist\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"rootDir\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"src\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"module\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"esnext\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"target\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"esnext\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"lib\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"dom\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"dom.iterable\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esnext\"</span><span class=\"p\">],</span><span class=\"w\">\n    </span><span class=\"nl\">\"declaration\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"strict\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"moduleResolution\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"node\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"jsx\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"react\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"skipLibCheck\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"esModuleInterop\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"emitDeclarationOnly\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"w\">\n  </span><span class=\"p\">}</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h1>\n  <a name=\"age\" href=\"#age\">\n  </a>\n  Age\n</h1>\n\n<p>Même chose pour notre deuxième package <code>@example/age</code></p>\n\n<p><code>package.json</code></p>\n\n<p>On ajoute une dependance à core :<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"nl\">\"dependencies\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nl\">\"@example/core\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"err\">,</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><code>index.ts</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight typescript\"><code><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">hello</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">@example/core</span><span class=\"dl\">'</span><span class=\"p\">;</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">age</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">:</span> <span class=\"kr\">string</span><span class=\"p\">,</span> <span class=\"nx\">age</span><span class=\"p\">:</span> <span class=\"kr\">number</span><span class=\"p\">)</span><span class=\"o\">=&gt;</span> <span class=\"p\">{</span>\n   <span class=\"k\">return</span> <span class=\"nx\">hello</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\"> you are </span><span class=\"dl\">'</span> <span class=\"o\">+</span> <span class=\"nx\">age</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h1>\n  <a name=\"turbo-build\" href=\"#turbo-build\">\n  </a>\n  Turbo build\n</h1>\n\n<p>Nos deux packages sont prêts, il ne reste plus qu'à les builder ensemble. Il faut tout de même paramétrer Turborepo pour builder <code>core</code> avant <code>age</code>.</p>\n\n<p>A la racine du repo :</p>\n\n<p><code>turbo.json</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nl\">\"pipeline\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"build\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"dependsOn\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"^build\"</span><span class=\"p\">],</span><span class=\"w\">\n      </span><span class=\"nl\">\"outputs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"dist/**\"</span><span class=\"p\">]</span><span class=\"w\">\n    </span><span class=\"p\">}</span><span class=\"w\">\n  </span><span class=\"p\">}</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p><code>package.json</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"example\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"0.1.0\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"private\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"workspaces\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"packages/*\"</span><span class=\"p\">],</span><span class=\"w\">\n  </span><span class=\"nl\">\"scripts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"build\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"turbo run build --filter=@example/*\"</span><span class=\"w\">\n  </span><span class=\"p\">},</span><span class=\"w\">\n  </span><span class=\"nl\">\"devDependencies\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"prettier\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"latest\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"turbo\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"latest\"</span><span class=\"w\">\n  </span><span class=\"p\">},</span><span class=\"w\">\n </span><span class=\"nl\">\"engines\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"npm\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"&gt;=7.0.0\"</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"node\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"&gt;=14.0.0\"</span><span class=\"w\">\n  </span><span class=\"p\">},</span><span class=\"w\">\n  </span><span class=\"nl\">\"prettier\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n    </span><span class=\"nl\">\"singleQuote\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"tabWidth\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\">\n    </span><span class=\"nl\">\"printWidth\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">120</span><span class=\"w\">\n  </span><span class=\"p\">},</span><span class=\"w\">\n  </span><span class=\"nl\">\"packageManager\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"yarn@1.22.5\"</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>On peut déjà exécuter les commandes suivantes pour un premier build :<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>yarn\nyarn build\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<h1>\n  <a name=\"test\" href=\"#test\">\n  </a>\n  Test\n</h1>\n\n<p>Si vous souhaitez ajouter des tests je vous conseille <a href=\"https://vitest.dev/\">Vitest</a>. Vous pouvez suivre la docs de <a href=\"https://turbo.build/repo/docs/handbook/testing\">Turborepo</a> à ce sujet.</p>\n\n<h1>\n  <a name=\"versionning\" href=\"#versionning\">\n  </a>\n  Versionning\n</h1>\n\n<p>Une étape un peu complexe est de gérer les bonnes versions des dépendances. Le plus simple est de considérer que tous nos packages possèdent le même numéro de version. On va tout de même devoir utiliser un script pour incrémenter notre numéro de versions sur toutes nos dépendances avant chaque publication.</p>\n\n<p>Pour ça on utilise <code>turboversion</code> :<br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>yarn add <span class=\"nt\">-W</span> <span class=\"nt\">-D</span> turboversion\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Le script sera exécuté avant chaque publication dans notre CI. Pour expliquer rapidement ce qu'il fait, il va scanner tout notre monorepo et incrémenter le numéro de version (patch, minor ou major) des dépendances et packages de notre scope <code>example</code>.</p>\n\n<h1>\n  <a name=\"publication\" href=\"#publication\">\n  </a>\n  Publication\n</h1>\n\n<p>On va reprendre notre Github Action de l'article précédent pour l'adapter à notre monorepo :</p>\n\n<p><code>.github/workflows/publish.yml</code><br>\n</p>\n\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Publish</span>\n<span class=\"na\">on</span><span class=\"pi\">:</span>\n  <span class=\"na\">workflow_dispatch</span><span class=\"pi\">:</span>\n    <span class=\"na\">inputs</span><span class=\"pi\">:</span>\n      <span class=\"na\">release</span><span class=\"pi\">:</span>\n        <span class=\"na\">description</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">major</span><span class=\"nv\"> </span><span class=\"s\">|</span><span class=\"nv\"> </span><span class=\"s\">minor</span><span class=\"nv\"> </span><span class=\"s\">|</span><span class=\"nv\"> </span><span class=\"s\">patch'</span>\n        <span class=\"na\">required</span><span class=\"pi\">:</span> <span class=\"no\">true</span>\n        <span class=\"na\">default</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">patch'</span>\n        <span class=\"na\">type</span><span class=\"pi\">:</span> <span class=\"s\">choice</span>\n        <span class=\"na\">options</span><span class=\"pi\">:</span>\n          <span class=\"pi\">-</span> <span class=\"s\">major</span>\n          <span class=\"pi\">-</span> <span class=\"s\">minor</span>\n          <span class=\"pi\">-</span> <span class=\"s\">patch</span>\n<span class=\"na\">jobs</span><span class=\"pi\">:</span>\n  <span class=\"na\">publish-new-version</span><span class=\"pi\">:</span>\n    <span class=\"na\">runs-on</span><span class=\"pi\">:</span> <span class=\"s\">ubuntu-latest</span>\n    <span class=\"na\">steps</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">🔌 Checkout</span>\n        <span class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/checkout@v3</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">🏗 Setup Node</span>\n        <span class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/setup-node@v3</span>\n        <span class=\"na\">with</span><span class=\"pi\">:</span>\n          <span class=\"na\">node-version</span><span class=\"pi\">:</span> <span class=\"s\">16.x</span>\n          <span class=\"na\">cache</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">yarn'</span>\n          <span class=\"na\">registry-url</span><span class=\"pi\">:</span> <span class=\"s\">https://registry.npmjs.org/</span>\n          <span class=\"na\">scope</span><span class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">@example'</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">⏳ Yarn install</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span> <span class=\"s\">yarn</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">🚀 Publish New Version</span>\n        <span class=\"na\">env</span><span class=\"pi\">:</span>\n          <span class=\"na\">NODE_AUTH_TOKEN</span><span class=\"pi\">:</span> <span class=\"s\">${{secrets.NPM_TOKEN}}</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span> <span class=\"pi\">|</span>\n          <span class=\"s\">git config --local user.email \"youremail\"</span>\n          <span class=\"s\">git config --local user.name \"yourname\"</span>\n          <span class=\"s\">yarn turboversion example ${{github.event.inputs.release}}</span>\n          <span class=\"s\">yarn publish:lib</span>\n          <span class=\"s\">PACKAGE_VERSION=$(node -p \"require('./package.json').version\")</span>\n          <span class=\"s\">git commit -a -m \"v${PACKAGE_VERSION}\"</span>\n          <span class=\"s\">git push</span>\n</code></pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode</title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"></path>\n</svg>\n\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode</title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"></path>\n</svg>\n\n</div>\n</div>\n</div>\n\n\n\n<p>Voilà, vous pouvez maintenant publier votre librairie et l'ensemble de ses packages avec un numéro de version cohérent.</p>\n\n","body_markdown":"# Plusieurs packages ?\n\nMaintenant que nous savons publier un package sur npm, nous allons voir comment gérer une librairie qui comporte plusieurs packages.\n\nVous pouvez consulter [cet exemple](https://github.com/simonboisset/validest) pour voir une application concrète.\n\n# Configuration\n\nPour gérer plusieurs modules ensemble nous allons utiliser Turborepo que vous avez déjà pu voir dans d'un article précédent.\n\n```bash\nnpx create-turbo@latest\n```\n\nVous pouvez supprimer les différents exemples de packages de base, nous allons créer les nôtres par la suite.\n\n# Builder\n\nOn va commencer par créer un package pour gérer les builds de nos librairies. Celui-ci ne sera pas publié mais uniquement partagé dans notre monorepo.\n\nCréez un dossier `builder` dans `packages` puis créez les fichiers suivants : \n\n`package.json`\n```json\n{\n  \"name\": \"builder\",\n  \"private\": true,\n  \"version\": \"0.1.0\",\n  \"bin\": \"index.js\",\n  \"dependencies\": { \"esbuild\": \"^0.14.42\", \"esbuild-node-externals\": \"^1.4.1\" }\n}\n```\n\n`index.js`\n```js\n#!/usr/bin/env node\n\nconst esbuild = require('esbuild');\nconst { nodeExternalsPlugin } = require('esbuild-node-externals');\nesbuild\n  .build({\n    entryPoints: ['./src/index.ts'],\n    outfile: 'dist/index.js',\n    bundle: true,\n    minify: true,\n    treeShaking: true,\n    platform: 'node',\n    format: 'cjs',\n    target: 'node14',\n    plugins: [nodeExternalsPlugin()],\n  })\n  .catch(() => process.exit(1));\n```\n\n# Nos packages\n\nMaintenant nous pouvons créer nos différents packages. Pour l'exemple nous allons en créer deux.\n\n## Core\n\nToujours dans le dossier `packages` on va créer un dossier `core` et les fichiers suivants :\n\n`package.json`\n```json\n{\n  \"name\": \"@example/core\",\n  \"version\": \"0.1.0\",\n  \"description\": \"A description\",\n  \"main\": \"dist/index.js\",\n  \"typings\": \"dist/index.d.ts\",\n  \"files\": [\"dist\"],\n  \"scripts\": {\n    \"build\": \"rm -rf dist && builder && tsc\",\n  },\n  \"author\": \"Your name\",\n  \"license\": \"MIT\",\n  \"devDependencies\": {\n    \"builder\": \"*\",\n    \"typescript\": \"^4.7.4\"\n  }\n}\n\n```\n\n> Vous remarquerez que nous avons utilisé un scope pour notre nom de package `@example`. Pour utiliser le votre vous devez créer une organisation du même nom sur npm.\n\n\n`src/index.ts`\n```ts\nexport const hello = (name: string)=> {\n   return 'Hello ' + name;\n}\n```\n\n`tsconfig.json`\n```json\n{\n  \"extends\": \"builder/ts.json\",\n  \"include\": [\"src\"],\n  \"exclude\": [\"src/**/*.test.ts\"],\n  \"compilerOptions\": {\n    \"outDir\": \"dist\",\n    \"rootDir\": \"src\",\n    \"module\": \"esnext\",\n    \"target\": \"esnext\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"declaration\": true,\n    \"strict\": true,\n    \"moduleResolution\": \"node\",\n    \"jsx\": \"react\",\n    \"skipLibCheck\": true,\n    \"esModuleInterop\": true,\n    \"emitDeclarationOnly\": true\n  }\n}\n```\n\n# Age\n\nMême chose pour notre deuxième package `@example/age`\n\n`package.json`\n\nOn ajoute une dependance à core :\n\n```json\n\"dependencies\": { \"@example/core\": \"0.1.0\" },\n```\n\n`index.ts`\n\n```ts\nimport { hello } from '@example/core';\n\nexport const age = (name: string, age: number)=> {\n   return hello(name) + ' you are ' + age;\n}\n```\n\n# Turbo build\n\nNos deux packages sont prêts, il ne reste plus qu'à les builder ensemble. Il faut tout de même paramétrer Turborepo pour builder `core` avant `age`.\n\nA la racine du repo :\n\n`turbo.json`\n\n```json\n{\n  \"pipeline\": {\n    \"build\": {\n      \"dependsOn\": [\"^build\"],\n      \"outputs\": [\"dist/**\"]\n    }\n  }\n}\n```\n\n`package.json`\n\n```json\n{\n  \"name\": \"example\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"workspaces\": [\"packages/*\"],\n  \"scripts\": {\n    \"build\": \"turbo run build --filter=@example/*\"\n  },\n  \"devDependencies\": {\n    \"prettier\": \"latest\",\n    \"turbo\": \"latest\"\n  },\n \"engines\": {\n    \"npm\": \">=7.0.0\",\n    \"node\": \">=14.0.0\"\n  },\n  \"prettier\": {\n    \"singleQuote\": true,\n    \"tabWidth\": 2,\n    \"printWidth\": 120\n  },\n  \"packageManager\": \"yarn@1.22.5\"\n}\n```\n\nOn peut déjà exécuter les commandes suivantes pour un premier build :\n\n```bash\nyarn\nyarn build\n```\n# Test\n\nSi vous souhaitez ajouter des tests je vous conseille [Vitest](https://vitest.dev/). Vous pouvez suivre la docs de [Turborepo](https://turbo.build/repo/docs/handbook/testing) à ce sujet.\n\n# Versionning\n\nUne étape un peu complexe est de gérer les bonnes versions des dépendances. Le plus simple est de considérer que tous nos packages possèdent le même numéro de version. On va tout de même devoir utiliser un script pour incrémenter notre numéro de versions sur toutes nos dépendances avant chaque publication.\n\nPour ça on utilise `turboversion` :\n\n```bash\nyarn add -W -D turboversion\n```\n\nLe script sera exécuté avant chaque publication dans notre CI. Pour expliquer rapidement ce qu'il fait, il va scanner tout notre monorepo et incrémenter le numéro de version (patch, minor ou major) des dépendances et packages de notre scope `example`.\n\n# Publication\n\nOn va reprendre notre Github Action de l'article précédent pour l'adapter à notre monorepo :\n\n`.github/workflows/publish.yml`\n\n```yml\nname: Publish\non:\n  workflow_dispatch:\n    inputs:\n      release:\n        description: 'major | minor | patch'\n        required: true\n        default: 'patch'\n        type: choice\n        options:\n          - major\n          - minor\n          - patch\njobs:\n  publish-new-version:\n    runs-on: ubuntu-latest\n    steps:\n      - name: 🔌 Checkout\n        uses: actions/checkout@v3\n      - name: 🏗 Setup Node\n        uses: actions/setup-node@v3\n        with:\n          node-version: 16.x\n          cache: 'yarn'\n          registry-url: https://registry.npmjs.org/\n          scope: '@example'\n      - name: ⏳ Yarn install\n        run: yarn\n      - name: 🚀 Publish New Version\n        env:\n          NODE_AUTH_TOKEN: ${{secrets.NPM_TOKEN}}\n        run: |\n          git config --local user.email \"youremail\"\n          git config --local user.name \"yourname\"\n          yarn turboversion example ${{github.event.inputs.release}}\n          yarn publish:lib\n          PACKAGE_VERSION=$(node -p \"require('./package.json').version\")\n          git commit -a -m \"v${PACKAGE_VERSION}\"\n          git push\n```\n\nVoilà, vous pouvez maintenant publier votre librairie et l'ensemble de ses packages avec un numéro de version cohérent.","user":{"name":"Simon Boisset","username":"simonboisset","twitter_username":"simonboisset","github_username":"simonboisset","user_id":915286,"website_url":"https://simonboisset.com/","profile_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--DlKPeeaN--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/915286/a3eb8e27-4168-4b37-9aa1-4a9561d1bd54.jpg","profile_image_90":"https://res.cloudinary.com/practicaldev/image/fetch/s--4RJ0oOij--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/915286/a3eb8e27-4168-4b37-9aa1-4a9561d1bd54.jpg"}}